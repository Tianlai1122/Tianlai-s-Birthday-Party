# ğŸš€ Supabase æ•°æ®æŒä¹…åŒ–é…ç½®æŒ‡å—

## âœ¨ ä¸ºä»€ä¹ˆé€‰æ‹© Supabaseï¼Ÿ

- âœ… **å®Œå…¨å…è´¹**ï¼š500MB PostgreSQL æ•°æ®åº“ + 1GB æ–‡ä»¶å­˜å‚¨
- âœ… **è¶…çº§ç¨³å®š**ï¼šæ¯” MongoDB Atlas è¿æ¥æ›´å¯é 
- âœ… **å®æ—¶åŒæ­¥**ï¼šæ•°æ®æ›´æ–°è‡ªåŠ¨æ¨é€åˆ°å‰ç«¯
- âœ… **å‹å¥½ç•Œé¢**ï¼šå¯è§†åŒ–æŸ¥çœ‹å’Œç¼–è¾‘æ•°æ®
- âœ… **é›¶é…ç½®**ï¼šåªéœ€è¦ 2 ä¸ªç¯å¢ƒå˜é‡

---

## ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Supabase é¡¹ç›®

### 1ï¸âƒ£ æ³¨å†Œè´¦æˆ·

1. è®¿é—® [supabase.com](https://supabase.com)
2. ç‚¹å‡» **"Start your project"**
3. é€‰æ‹© **"Sign in with GitHub"**ï¼ˆæ¨èï¼‰æˆ–ä½¿ç”¨é‚®ç®±æ³¨å†Œ

### 2ï¸âƒ£ åˆ›å»ºæ–°é¡¹ç›®

1. ç™»å½•åï¼Œç‚¹å‡» **"New Project"**
2. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   - **Name**: `tianlai-birthday-party`ï¼ˆæˆ–ä»»æ„åå­—ï¼‰
   - **Database Password**: è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼ˆ**è®°ä½å®ƒï¼**ï¼‰
   - **Region**: é€‰æ‹© `Northeast Asia (Tokyo)` æˆ– `Southeast Asia (Singapore)`
   - **Pricing Plan**: é€‰æ‹© **Free** ($0/month)
3. ç‚¹å‡» **"Create new project"**
4. ç­‰å¾… 1-2 åˆ†é’Ÿï¼Œé¡¹ç›®åˆ›å»ºå®Œæˆ

### 3ï¸âƒ£ åˆ›å»ºæ•°æ®è¡¨

1. åœ¨å·¦ä¾§èœå•ç‚¹å‡» **"Table Editor"**
2. ç‚¹å‡» **"Create a new table"**
3. å¡«å†™è¡¨ä¿¡æ¯ï¼š
   - **Name**: `party_data`
   - **Description**: `Birthday party data storage`
   - å–æ¶ˆå‹¾é€‰ **"Enable Row Level Security (RLS)"**ï¼ˆé‡è¦ï¼ï¼‰
4. æ·»åŠ ä»¥ä¸‹åˆ—ï¼ˆColumnsï¼‰ï¼š

| Name | Type | Default Value | Primary | Nullable |
|------|------|---------------|---------|----------|
| `id` | `text` | - | âœ… Yes | âŒ No |
| `data` | `jsonb` | - | âŒ No | âŒ No |
| `updated_at` | `timestamptz` | `now()` | âŒ No | âŒ No |

5. ç‚¹å‡» **"Save"**

### 4ï¸âƒ£ æ’å…¥åˆå§‹æ•°æ®

1. åœ¨ **Table Editor** ä¸­ï¼Œé€‰æ‹© `party_data` è¡¨
2. ç‚¹å‡» **"Insert row"**
3. å¡«å†™ï¼š
   - **id**: `main`
   - **data**: ç‚¹å‡» **"Edit JSON"**ï¼Œç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š

```json
{
  "foodies": [],
  "drinkers": [],
  "gamePreferences": [],
  "vibeVotes": [],
  "krystalLikes": 0,
  "memberLikes": {},
  "memberComments": {},
  "customMembers": [],
  "gameLobbies": [],
  "visits": 0,
  "lastVisit": null,
  "visitHistory": []
}
```

4. ç‚¹å‡» **"Save"**

### 5ï¸âƒ£ è·å– API å‡­è¯

1. åœ¨å·¦ä¾§èœå•ç‚¹å‡» **"Settings"** (é½¿è½®å›¾æ ‡)
2. ç‚¹å‡» **"API"**
3. æ‰¾åˆ°ä»¥ä¸‹ä¸¤ä¸ªå€¼ï¼ˆ**å¤åˆ¶ä¿å­˜ï¼**ï¼‰ï¼š

**Project URL:**
```
https://xxxxxxxxxxxxx.supabase.co
```

**API Key (anon, public):**
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSI...
```

---

## ğŸ”§ ç¬¬äºŒæ­¥ï¼šé…ç½® Render ç¯å¢ƒå˜é‡

### 1ï¸âƒ£ ç™»å½• Render

1. è®¿é—® [dashboard.render.com](https://dashboard.render.com/)
2. æ‰¾åˆ°ä½ çš„åç«¯æœåŠ¡ï¼ˆä¾‹å¦‚ï¼š`tianlai-backend`ï¼‰
3. ç‚¹å‡»è¿›å…¥æœåŠ¡è¯¦æƒ…é¡µ

### 2ï¸âƒ£ æ·»åŠ ç¯å¢ƒå˜é‡

1. ç‚¹å‡»å·¦ä¾§çš„ **"Environment"** æ ‡ç­¾
2. ç‚¹å‡» **"Add Environment Variable"**
3. æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªå˜é‡ï¼š

**å˜é‡ 1:**
- **Key**: `SUPABASE_URL`
- **Value**: ä½ çš„ Project URLï¼ˆæ­¥éª¤ 5ï¸âƒ£ è·å–çš„ï¼‰

**å˜é‡ 2:**
- **Key**: `SUPABASE_KEY`
- **Value**: ä½ çš„ API Keyï¼ˆæ­¥éª¤ 5ï¸âƒ£ è·å–çš„ï¼‰

4. ç‚¹å‡» **"Save Changes"**

### 3ï¸âƒ£ ç­‰å¾…é‡æ–°éƒ¨ç½²

- Render ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²ä½ çš„æœåŠ¡
- ç­‰å¾… 2-3 åˆ†é’Ÿ
- æŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š`âœ… Supabase è¿æ¥æˆåŠŸï¼`

---

## ğŸ’» ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°æœ¬åœ°ä»£ç 

### 1ï¸âƒ£ æ›´æ–°ä¾èµ–åŒ…

åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š

```bash
cd backend
npm uninstall mongodb
npm install @supabase/supabase-js
```

### 2ï¸âƒ£ æäº¤å¹¶æ¨é€

```bash
git add .
git commit -m "è¿ç§»åˆ° Supabase æ•°æ®åº“"
git push
```

### 3ï¸âƒ£ ç­‰å¾…è‡ªåŠ¨éƒ¨ç½²

- Render ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç æ›´æ–°
- é‡æ–°éƒ¨ç½²åç«¯ï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰

---

## âœ… ç¬¬å››æ­¥ï¼šéªŒè¯é…ç½®

### 1ï¸âƒ£ æ£€æŸ¥ Render æ—¥å¿—

1. åœ¨ Render Dashboard ä¸­ï¼Œç‚¹å‡»ä½ çš„æœåŠ¡
2. ç‚¹å‡» **"Logs"** æ ‡ç­¾
3. æŸ¥çœ‹æœ€æ–°æ—¥å¿—

**æˆåŠŸçš„æ—¥å¿—ï¼š**
```
âœ… Supabase è¿æ¥æˆåŠŸï¼æ•°æ®å°†æŒä¹…åŒ–ä¿å­˜
âœ… ä» Supabase åŠ è½½æ•°æ®æˆåŠŸ
ğŸš€ ä¸»æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ 3000
```

**å¤±è´¥çš„æ—¥å¿—ï¼ˆéœ€è¦æ£€æŸ¥é…ç½®ï¼‰ï¼š**
```
âŒ Supabase è¿æ¥å¤±è´¥
âš ï¸  æœªé…ç½® SUPABASE_URL æˆ– SUPABASE_KEY
```

### 2ï¸âƒ£ æµ‹è¯•ç½‘ç«™åŠŸèƒ½

1. è®¿é—®ä½ çš„å‰ç«¯ç½‘ç«™
2. æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š
   - âœ… ç‚¹èµ
   - âœ… å‘é€ç•™è¨€
   - âœ… æ·»åŠ å°é¦‹çŒ«
   - âœ… åˆ›å»ºæ¸¸æˆç»„å±€
   - âœ… æŠ•ç¥¨

### 3ï¸âƒ£ åœ¨ Supabase æŸ¥çœ‹æ•°æ®

1. ç™»å½• Supabase Dashboard
2. ç‚¹å‡» **"Table Editor"**
3. é€‰æ‹© `party_data` è¡¨
4. ç‚¹å‡» `id = main` çš„è¡Œ
5. æŸ¥çœ‹ `data` å­—æ®µï¼Œåº”è¯¥èƒ½çœ‹åˆ°åˆšæ‰æ·»åŠ çš„æ•°æ®

---

## ğŸ‰ ä¼˜åŠ¿å¯¹æ¯”

| ç‰¹æ€§ | MongoDB Atlas | Supabase |
|------|---------------|----------|
| å…è´¹é¢åº¦ | 512MB | 500MB |
| è¿æ¥ç¨³å®šæ€§ | âš ï¸ ç»å¸¸è¶…æ—¶ | âœ… éå¸¸ç¨³å®š |
| é…ç½®éš¾åº¦ | ğŸ˜° å¤æ‚ | ğŸ˜Š ç®€å• |
| æ•°æ®æŸ¥çœ‹ | ğŸ˜ ä¸€èˆ¬ | ğŸ˜ è¶…çº§å‹å¥½ |
| å®æ—¶åŠŸèƒ½ | âŒ éœ€è¦é¢å¤–é…ç½® | âœ… å†…ç½®æ”¯æŒ |
| API æ–¹å¼ | éœ€è¦é©±åŠ¨ | REST API |

---

## ğŸ”„ æ•°æ®è¿ç§»

å¦‚æœä½ ä¹‹å‰åœ¨ MongoDB æˆ–æ–‡ä»¶ç³»ç»Ÿä¸­æœ‰æ•°æ®ï¼š

### æ–¹æ³• 1ï¼šæ‰‹åŠ¨è¿ç§»

1. ä¸‹è½½å½“å‰çš„ `backend/party-data.json`
2. åœ¨ Supabase Table Editor ä¸­
3. ç¼–è¾‘ `id = main` çš„è¡Œ
4. å°† JSON æ•°æ®ç²˜è´´åˆ° `data` å­—æ®µ

### æ–¹æ³• 2ï¼šä½¿ç”¨ Admin åå°

1. è®¿é—® `https://ä½ çš„ç½‘ç«™.vercel.app/admin.html`
2. ä½¿ç”¨"å¯¼å…¥æ•°æ®"åŠŸèƒ½
3. ä¸Šä¼  `party-data.json`

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆè¦ç¦ç”¨ Row Level Security (RLS)ï¼Ÿ

A: RLS æ˜¯ Supabase çš„å®‰å…¨åŠŸèƒ½ï¼Œä½†éœ€è¦é¢å¤–é…ç½®æƒé™ç­–ç•¥ã€‚å¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬ä½¿ç”¨ API Key æ¥ä¿æŠ¤æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥ç¦ç”¨ RLS ç®€åŒ–é…ç½®ã€‚

### Q: API Key ä¼šæ³„éœ²å—ï¼Ÿ

A: æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `anon` keyï¼Œå®ƒæ˜¯å…¬å¼€çš„ï¼Œåªèƒ½è®¿é—®ä½ å…è®¸çš„æ•°æ®ã€‚çœŸæ­£çš„å®‰å…¨ç”± Supabase çš„æƒé™ç³»ç»Ÿä¿è¯ã€‚

### Q: å¦‚ä½•æŸ¥çœ‹å®æ—¶æ•°æ®ï¼Ÿ

A: åœ¨ Supabase Dashboard â†’ Table Editor ä¸­ï¼Œæ•°æ®ä¼šè‡ªåŠ¨åˆ·æ–°ã€‚ä½ ä¹Ÿå¯ä»¥ç‚¹å‡»åˆ·æ–°æŒ‰é’®ã€‚

### Q: æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ

A: âœ… **ä¸ä¼šï¼** Supabase çš„æ•°æ®æ˜¯æ°¸ä¹…ä¿å­˜çš„ï¼Œå³ä½¿ä½ çš„åº”ç”¨é‡æ–°éƒ¨ç½²ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚

### Q: å…è´¹ç‰ˆæœ‰ä»€ä¹ˆé™åˆ¶ï¼Ÿ

A: 
- 500MB æ•°æ®åº“å­˜å‚¨
- 1GB æ–‡ä»¶å­˜å‚¨
- 2GB æ•°æ®ä¼ è¾“/æœˆ
- å¯¹äºè¿™ä¸ªé¡¹ç›®å®Œå…¨å¤Ÿç”¨ï¼

### Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ

A: 
1. Supabase Dashboard â†’ Database â†’ Backups
2. æˆ–è€…åœ¨ Table Editor ä¸­å¯¼å‡ºä¸º CSV/JSON

---

## ğŸš€ æœ¬åœ°å¼€å‘é…ç½®

å¦‚æœä½ æƒ³åœ¨æœ¬åœ°æµ‹è¯•ï¼š

### 1ï¸âƒ£ åˆ›å»º `.env` æ–‡ä»¶

åœ¨ `backend/` æ–‡ä»¶å¤¹ä¸­åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
SUPABASE_URL=https://xxxxxxxxxxxxx.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 2ï¸âƒ£ å®‰è£… dotenv

```bash
npm install dotenv
```

### 3ï¸âƒ£ åœ¨ server.js é¡¶éƒ¨æ·»åŠ 

```javascript
require('dotenv').config();
```

### 4ï¸âƒ£ å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨

```bash
npm start
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

### æ£€æŸ¥æ¸…å•

- [ ] Supabase é¡¹ç›®å·²åˆ›å»º
- [ ] `party_data` è¡¨å·²åˆ›å»º
- [ ] Row Level Security å·²ç¦ç”¨
- [ ] åˆå§‹æ•°æ®å·²æ’å…¥
- [ ] API URL å’Œ Key å·²å¤åˆ¶
- [ ] Render ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] ä»£ç å·²æ›´æ–°å¹¶æ¨é€
- [ ] Render æ—¥å¿—æ˜¾ç¤ºè¿æ¥æˆåŠŸ
- [ ] ç½‘ç«™åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### è°ƒè¯•æ­¥éª¤

1. **è¿æ¥å¤±è´¥**ï¼šæ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®
2. **æ•°æ®ä¸ä¿å­˜**ï¼šæ£€æŸ¥ RLS æ˜¯å¦ç¦ç”¨
3. **æ‰¾ä¸åˆ°è¡¨**ï¼šç¡®è®¤è¡¨åæ˜¯ `party_data`
4. **æƒé™é”™è¯¯**ï¼šæ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®

---

## ğŸŠ å®Œæˆï¼

é…ç½®å®Œæˆåï¼Œä½ çš„æ•°æ®å°†ï¼š
- âœ… æ°¸ä¹…ä¿å­˜åœ¨ Supabase
- âœ… ä¸ä¼šå› é‡æ–°éƒ¨ç½²è€Œä¸¢å¤±
- âœ… å¯ä»¥åœ¨å‹å¥½çš„ç•Œé¢ä¸­æŸ¥çœ‹å’Œç¼–è¾‘
- âœ… å®Œå…¨å…è´¹ï¼

äº«å—ä½ çš„ç”Ÿæ—¥æ´¾å¯¹ç½‘ç«™å§ï¼ğŸ‰

