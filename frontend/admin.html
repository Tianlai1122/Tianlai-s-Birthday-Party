<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜åå° - ç”Ÿæ—¥æ´¾å¯¹</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .admin-page {
            min-height: 100vh;
            background: var(--dark);
            padding: 40px 20px;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .admin-header h1 {
            font-size: 3rem;
            background: var(--gradient-party);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .stat-card .stat-value {
            font-size: 3rem;
            font-weight: 700;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 10px 0;
        }
        
        .stat-card .stat-label {
            font-size: 1.1rem;
            opacity: 0.8;
        }
        
        .data-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }
        
        .data-section h2 {
            font-size: 2rem;
            color: var(--accent);
            margin-bottom: 20px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-table th {
            background: rgba(255, 255, 255, 0.05);
            font-weight: 600;
            color: var(--accent);
        }
        
        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .refresh-indicator {
            text-align: center;
            padding: 10px;
            background: rgba(79, 172, 254, 0.2);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
        }
        
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .bar-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .bar-label {
            min-width: 150px;
            font-weight: 600;
        }
        
        .bar-visual {
            flex: 1;
            height: 30px;
            background: var(--gradient-2);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .bar-value {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: 600;
            color: white;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            background: var(--gradient-2);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);
        }

        .btn-primary {
            background: var(--gradient-party);
        }

        select {
            padding: 8px 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            cursor: pointer;
        }

        select option {
            background: var(--dark);
            color: white;
        }

        .tab-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: var(--gradient-party);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .edit-form {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--accent);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .member-card-edit {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .member-card-edit .member-info {
            flex: 1;
        }

        .member-card-edit .member-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .btn-danger {
            background: rgba(255, 0, 0, 0.3);
        }

        .btn-danger:hover {
            background: rgba(255, 0, 0, 0.5);
        }

        .btn-success {
            background: rgba(0, 255, 0, 0.3);
        }

        .btn-success:hover {
            background: rgba(0, 255, 0, 0.5);
        }

        /* ==================== ç´§å‡‘åˆ—è¡¨æ ·å¼ ==================== */
        .compact-list {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            overflow: hidden;
        }

        .compact-list-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .compact-list-item:hover {
            background: rgba(255, 107, 157, 0.1);
        }

        .compact-list-item:last-child {
            border-bottom: none;
        }

        .compact-list-item .drag-handle {
            cursor: grab;
            font-size: 1.2rem;
            margin-right: 15px;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }

        .compact-list-item:hover .drag-handle {
            opacity: 1;
        }

        .compact-list-item.dragging {
            opacity: 0.5;
            background: rgba(255, 107, 157, 0.2);
        }

        .compact-list-item .item-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .compact-list-item .item-name {
            font-weight: 600;
            font-size: 1.05rem;
        }

        .compact-list-item .item-role {
            opacity: 0.7;
            font-size: 0.95rem;
        }

        .compact-list-item .item-actions {
            display: flex;
            gap: 10px;
        }

        .compact-list-item .btn-icon {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .compact-list-item .btn-icon:hover {
            background: rgba(255, 107, 157, 0.3);
            transform: scale(1.1);
        }

        /* ç¼–è¾‘æ¨¡æ€çª—å£ */
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .edit-modal.active {
            display: flex;
        }

        .edit-modal-content {
            background: var(--dark);
            border: 2px solid rgba(255, 107, 157, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .edit-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .edit-modal-header h3 {
            font-size: 1.8rem;
            background: var(--gradient-party);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .edit-modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .edit-modal-close:hover {
            background: rgba(255, 0, 0, 0.3);
            transform: rotate(90deg);
        }

        .edit-modal-footer {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: flex-end;
        }
    </style>
</head>
<body>
    <div class="admin-page">
        <div class="admin-container">
            <div class="admin-header">
                <h1>ğŸ“Š ç®¡ç†å‘˜åå°</h1>
                <p>å®æ—¶ç›‘æ§æ´¾å¯¹æ•°æ® & å†…å®¹ç®¡ç†</p>

                <!-- å¯¼èˆªæ ‡ç­¾ -->
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
                    <button onclick="switchTab('stats')" id="tab-stats" class="tab-btn active">ğŸ“Š æ•°æ®ç»Ÿè®¡</button>
                    <button onclick="switchTab('content')" id="tab-content" class="tab-btn">âœï¸ å†…å®¹ç¼–è¾‘</button>
                    <button onclick="switchTab('members')" id="tab-members" class="tab-btn">ğŸ‘¥ æˆå‘˜ç®¡ç†</button>
                </div>
            </div>
            
            <div class="refresh-indicator" id="refresh-indicator">
                ğŸ”„ è‡ªåŠ¨åˆ·æ–°ä¸­... æœ€åæ›´æ–°: <span id="last-update">--</span>
            </div>

            <!-- ==================== æ•°æ®ç»Ÿè®¡æ ‡ç­¾ ==================== -->
            <div id="stats-tab" class="tab-content active">

            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ğŸ‘¥ æ€»è®¿é—®æ¬¡æ•°</div>
                    <div class="stat-value" id="total-visits">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ğŸ± å°é¦‹çŒ«äººæ•°</div>
                    <div class="stat-value" id="foodies-count">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ğŸº é€ƒé…’äººæ•°</div>
                    <div class="stat-value" id="drinkers-count">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ğŸ» æ€»æ¯æ•°</div>
                    <div class="stat-value" id="total-drinks">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">âœ¨ VibeæŠ•ç¥¨</div>
                    <div class="stat-value" id="vibe-votes">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ğŸ‘ æ€»ç‚¹èµæ•°</div>
                    <div class="stat-value" id="total-likes">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ğŸ’¬ æ€»ç•™è¨€æ•°</div>
                    <div class="stat-value" id="total-comments">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ğŸ‘¥ å›¢é˜Ÿæˆå‘˜</div>
                    <div class="stat-value">14</div>
                </div>
            </div>
            
            <!-- å°é¦‹çŒ«åˆ—è¡¨ -->
            <div class="data-section">
                <h2>ğŸ± å°é¦‹çŒ«åˆ—è¡¨</h2>
                <div id="foodies-list"></div>
            </div>
            
            <!-- é€ƒé…’æ’è¡Œæ¦œ -->
            <div class="data-section">
                <h2>ğŸº é€ƒé…’æ’è¡Œæ¦œ</h2>
                <table class="data-table" id="drinkers-table">
                    <thead>
                        <tr>
                            <th>æ’å</th>
                            <th>å§“å</th>
                            <th>æ¯æ•°</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            
            <!-- Vibe æŠ•ç¥¨ç»Ÿè®¡ -->
            <div class="data-section">
                <h2>âœ¨ Vibe æŠ•ç¥¨ç»Ÿè®¡</h2>
                <div class="chart-container">
                    <div class="bar-chart" id="vibe-chart"></div>
                </div>
                <table class="data-table" id="vibe-table" style="margin-top: 30px;">
                    <thead>
                        <tr>
                            <th>Vibeç±»å‹</th>
                            <th>æŠ•ç¥¨äºº</th>
                            <th>ç¥¨æ•°</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- å›¢é˜Ÿæˆå‘˜ç‚¹èµç»Ÿè®¡ -->
            <div class="data-section">
                <h2>ğŸ‘ å›¢é˜Ÿæˆå‘˜ç‚¹èµæ’è¡Œ</h2>
                <table class="data-table" id="member-likes-table">
                    <thead>
                        <tr>
                            <th>æ’å</th>
                            <th>æˆå‘˜</th>
                            <th>ç‚¹èµæ•°</th>
                            <th>ç•™è¨€æ•°</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- å›¢é˜Ÿæˆå‘˜ç•™è¨€ç®¡ç† -->
            <div class="data-section">
                <h2>ğŸ’¬ å›¢é˜Ÿæˆå‘˜ç•™è¨€ç®¡ç†</h2>
                <div style="margin-bottom: 20px;">
                    <label for="member-filter" style="margin-right: 10px;">ç­›é€‰æˆå‘˜:</label>
                    <select id="member-filter" onchange="filterComments()" style="padding: 8px 15px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
                        <option value="">å…¨éƒ¨æˆå‘˜</option>
                    </select>
                </div>
                <div id="comments-container"></div>
            </div>

            <!-- æ¸¸æˆåå¥½ç»Ÿè®¡ -->
            <div class="data-section">
                <h2>ğŸ® æ¸¸æˆåå¥½ç»Ÿè®¡</h2>
                <div class="chart-container">
                    <div class="bar-chart" id="game-chart"></div>
                </div>
                <table class="data-table" id="game-table" style="margin-top: 30px;">
                    <thead>
                        <tr>
                            <th>æ¸¸æˆç±»å‹</th>
                            <th>æŠ•ç¥¨äºº</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            
            <!-- è®¿é—®å†å² -->
            <div class="data-section">
                <h2>ğŸ“ˆ æœ€è¿‘è®¿é—®è®°å½•</h2>
                <table class="data-table" id="visits-table">
                    <thead>
                        <tr>
                            <th>æ—¶é—´</th>
                            <th>IPåœ°å€</th>
                            <th>æµè§ˆå™¨</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- æ¸¸æˆç»„å±€ç»Ÿè®¡ -->
            <div class="data-section">
                <h2>ğŸ® æ¸¸æˆç»„å±€ç»Ÿè®¡</h2>
                <div class="stats-grid" style="margin-bottom: 20px;">
                    <div class="stat-card">
                        <div class="stat-value" id="total-lobbies">0</div>
                        <div class="stat-label">æ€»ç»„å±€æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-lobby-participants">0</div>
                        <div class="stat-label">æ€»å‚ä¸äººæ¬¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="most-popular-game">-</div>
                        <div class="stat-label">æœ€çƒ­é—¨æ¸¸æˆ</div>
                    </div>
                </div>
                <table class="data-table" id="lobbies-table">
                    <thead>
                        <tr>
                            <th>æ¸¸æˆ</th>
                            <th>å‘èµ·äºº</th>
                            <th>æ—¶é—´</th>
                            <th>å‚ä¸äººæ•°</th>
                            <th>å‚ä¸è€…</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="data-section">
                <h2>âš™ï¸ æ“ä½œ</h2>
                <div class="action-buttons">
                    <button onclick="refreshData()" class="btn btn-primary">
                        ğŸ”„ æ‰‹åŠ¨åˆ·æ–°
                    </button>
                    <button onclick="exportData()" class="btn btn-primary">
                        ğŸ’¾ å¯¼å‡ºæ•°æ®
                    </button>
                    <button onclick="window.open('/', '_blank')" class="btn btn-primary">
                        ğŸ  æ‰“å¼€ä¸»é¡µ
                    </button>
                    <button onclick="clearAllData()" class="btn" style="background: rgba(255,0,0,0.3);">
                        ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®
                    </button>
                </div>
            </div>

            </div> <!-- ç»“æŸæ•°æ®ç»Ÿè®¡æ ‡ç­¾ -->

            <!-- ==================== å†…å®¹ç¼–è¾‘æ ‡ç­¾ ==================== -->
            <div id="content-tab" class="tab-content">

                <!-- æ´¾å¯¹åŸºæœ¬ä¿¡æ¯ç¼–è¾‘ -->
                <div class="data-section">
                    <h2>ğŸ‰ æ´¾å¯¹åŸºæœ¬ä¿¡æ¯</h2>
                    <p style="opacity: 0.8; margin-bottom: 20px;">âœï¸ ç›´æ¥åœ¨è¾“å…¥æ¡†ä¸­ç¼–è¾‘å†…å®¹ï¼Œç„¶åç‚¹å‡»"ä¿å­˜"æŒ‰é’®</p>
                    <div class="edit-form">
                        <div class="form-group">
                            <label>æ´¾å¯¹æ ‡é¢˜</label>
                            <input type="text" id="edit-party-title" value="Noah's 22nd Birthday Party ğŸ‰">
                        </div>
                        <div class="form-group">
                            <label>æ´¾å¯¹æ—¥æœŸ</label>
                            <input type="text" id="edit-party-date" value="November 22, 2025 (Friday)">
                        </div>
                        <div class="form-group">
                            <label>æ´¾å¯¹æ—¶é—´</label>
                            <input type="text" id="edit-party-time" value="8:30 PM - Late">
                        </div>
                        <div class="form-group">
                            <label>æ´¾å¯¹åœ°å€</label>
                            <textarea id="edit-party-address">301 W Rosemary St, Chapel Hill, NC 27516</textarea>
                        </div>
                        <div class="form-group">
                            <label>è”ç³»ç”µè¯</label>
                            <input type="text" id="edit-party-phone" value="919-360-8558">
                        </div>
                        <button onclick="savePartyInfo()" class="btn btn-success">ğŸ’¾ ä¿å­˜åŸºæœ¬ä¿¡æ¯</button>
                    </div>
                </div>

                <!-- æ—¶é—´å®‰æ’ç¼–è¾‘ -->
                <div class="data-section">
                    <h2>â° æ—¶é—´å®‰æ’</h2>
                    <p style="opacity: 0.8; margin-bottom: 20px;">âœï¸ ç›´æ¥åœ¨è¾“å…¥æ¡†ä¸­ç¼–è¾‘æ—¶é—´å’Œäº‹ä»¶ï¼Œç¼–è¾‘æ—¶ä¼šæœ‰é‡‘è‰²è¾¹æ¡†æç¤º</p>
                    <div id="timeline-editor"></div>
                    <button onclick="addTimelineItem()" class="btn btn-primary" style="margin-top: 15px;">â• æ·»åŠ æ—¶é—´ç‚¹</button>
                    <button onclick="saveTimeline()" class="btn btn-success" style="margin-top: 15px;">ğŸ’¾ ä¿å­˜æ—¶é—´å®‰æ’</button>
                </div>

            </div> <!-- ç»“æŸå†…å®¹ç¼–è¾‘æ ‡ç­¾ -->

            <!-- ==================== æˆå‘˜ç®¡ç†æ ‡ç­¾ ==================== -->
            <div id="members-tab" class="tab-content">

                <!-- Support å›¢é˜Ÿæˆå‘˜ç®¡ç† -->
                <div class="data-section">
                    <h2>ğŸ‘¥ Support å›¢é˜Ÿæˆå‘˜ç®¡ç†</h2>
                    <p style="opacity: 0.8; margin-bottom: 20px;">
                        ğŸ–±ï¸ æ‹–æ‹½è°ƒæ•´é¡ºåº | âœï¸ ç‚¹å‡»ç¼–è¾‘ | â• æ·»åŠ æ–°æˆå‘˜
                    </p>
                    <div id="support-members-list" class="compact-list"></div>
                    <button onclick="addSupportMember()" class="btn btn-primary" style="margin-top: 15px;">â• æ·»åŠ æ–°æˆå‘˜</button>
                    <button onclick="saveSupportMembers()" class="btn btn-success" style="margin-top: 15px;">ğŸ’¾ ä¿å­˜æˆå‘˜ä¿¡æ¯</button>
                </div>

                <!-- å¯¼èˆªèœå•ç®¡ç† -->
                <div class="data-section">
                    <h2>ğŸ§­ å¯¼èˆªèœå•ç®¡ç†</h2>
                    <p style="opacity: 0.8; margin-bottom: 20px;">
                        ğŸ–±ï¸ æ‹–æ‹½è°ƒæ•´é¡ºåº | âœï¸ ç‚¹å‡»ç¼–è¾‘èœå•é¡¹
                    </p>
                    <div id="nav-menu-list" class="compact-list"></div>
                    <button onclick="saveNavMenu()" class="btn btn-success" style="margin-top: 15px;">ğŸ’¾ ä¿å­˜èœå•é¡ºåº</button>
                </div>

                <!-- è‡ªå®šä¹‰æˆå‘˜ç®¡ç† -->
                <div class="data-section">
                    <h2>âœ¨ è‡ªå®šä¹‰æˆå‘˜ç®¡ç†</h2>
                    <p style="opacity: 0.8; margin-bottom: 20px;">ç®¡ç†ç”¨æˆ·æ·»åŠ çš„è‡ªå®šä¹‰æˆå‘˜</p>
                    <div id="custom-members-list"></div>
                </div>

            </div> <!-- ç»“æŸæˆå‘˜ç®¡ç†æ ‡ç­¾ -->

        </div>
    </div>

    <!-- Support æˆå‘˜ç¼–è¾‘æ¨¡æ€çª—å£ -->
    <div id="edit-member-modal" class="edit-modal">
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>âœï¸ ç¼–è¾‘æˆå‘˜ä¿¡æ¯</h3>
                <button class="edit-modal-close" onclick="closeEditMemberModal()">âœ•</button>
            </div>
            <div class="form-group">
                <label>IDï¼ˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼‰</label>
                <input type="text" id="edit-member-id" placeholder="ä¾‹å¦‚: geyuxin">
            </div>
            <div class="form-group">
                <label>åå­—</label>
                <input type="text" id="edit-member-name" placeholder="ä¾‹å¦‚: @è‘›è¯­æ­†">
            </div>
            <div class="form-group">
                <label>è§’è‰²</label>
                <input type="text" id="edit-member-role" placeholder="ä¾‹å¦‚: ğŸ“· CCDæ‘„å½±å¸ˆ">
            </div>
            <div class="form-group">
                <label>æè¿°</label>
                <textarea id="edit-member-description" placeholder="ä¾‹å¦‚: æ€»èƒ½å‘ç°åˆ«äººè‡ªæ‹éƒ½æ²¡æ³¨æ„åˆ°çš„åŒä¸‹å·´ã€‚"></textarea>
            </div>
            <div class="edit-modal-footer">
                <button onclick="closeEditMemberModal()" class="btn btn-secondary">å–æ¶ˆ</button>
                <button onclick="saveEditedMember()" class="btn btn-success">ğŸ’¾ ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- å¯¼èˆªèœå•ç¼–è¾‘æ¨¡æ€çª—å£ -->
    <div id="edit-nav-modal" class="edit-modal">
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h3>âœï¸ ç¼–è¾‘å¯¼èˆªèœå•é¡¹</h3>
                <button class="edit-modal-close" onclick="closeEditNavModal()">âœ•</button>
            </div>
            <div class="form-group">
                <label>ä¸­æ–‡æ ‡ç­¾</label>
                <input type="text" id="edit-nav-label" placeholder="ä¾‹å¦‚: ğŸ  é¦–é¡µ">
            </div>
            <div class="form-group">
                <label>è‹±æ–‡æ ‡ç­¾</label>
                <input type="text" id="edit-nav-label-en" placeholder="ä¾‹å¦‚: ğŸ  Home">
            </div>
            <div class="form-group">
                <label>ç›®æ ‡ Section ID</label>
                <input type="text" id="edit-nav-target" placeholder="ä¾‹å¦‚: hero">
            </div>
            <div class="edit-modal-footer">
                <button onclick="closeEditNavModal()" class="btn btn-secondary">å–æ¶ˆ</button>
                <button onclick="saveEditedNavItem()" class="btn btn-success">ğŸ’¾ ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // API é…ç½® - ç¯å¢ƒè‡ªé€‚åº”
        const API_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3000/api'
            : 'https://tianlai-s-birthday-party.onrender.com/api';

        let autoRefreshInterval;
        let currentSupportMembers = [];
        let currentTimeline = [];

        // è‡ªåŠ¨ä¿å­˜é€šçŸ¥
        function showAutoSaveNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: rgba(34, 197, 94, 0.9);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-size: 0.9rem;
                z-index: 10001;
                animation: slideIn 0.3s ease-out;
            `;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            refreshData();
            startAutoRefresh();
            loadContentForEditing();
        });

        // ==================== æ ‡ç­¾åˆ‡æ¢ ====================
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„ active çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾
            document.getElementById(`${tabName}-tab`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');

            // å¦‚æœåˆ‡æ¢åˆ°å†…å®¹ç¼–è¾‘æˆ–æˆå‘˜ç®¡ç†ï¼ŒåŠ è½½æ•°æ®
            if (tabName === 'content' || tabName === 'members') {
                loadContentForEditing();
            }
        }
        
        // è‡ªåŠ¨åˆ·æ–° - æ¥è¿‘å®æ—¶ï¼ˆæ¯2ç§’åˆ·æ–°ä¸€æ¬¡ï¼‰
        function startAutoRefresh() {
            autoRefreshInterval = setInterval(refreshData, 2000); // æ¯2ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œæ¥è¿‘å®æ—¶
        }
        
        // åˆ·æ–°æ•°æ®
        async function refreshData() {
            try {
                const response = await fetch(`${API_URL}/admin/full-data`);
                const data = await response.json();

                window.currentData = data; // ä¿å­˜åˆ°å…¨å±€å˜é‡

                updateStats(data);
                updateFoodiesList(data.foodies);
                updateDrinkersTable(data.drinkers);
                updateVibeVotes(data.vibeVotes);
                updateMemberLikes(data.memberLikes, data.memberComments);
                updateMemberComments(data.memberComments);
                updateGamePreferences(data.gamePreferences);
                updateVisitsTable(data.visitHistory);
                updateGameLobbies(data.gameLobbies);

                document.getElementById('last-update').textContent = new Date().toLocaleTimeString('zh-CN');
            } catch (error) {
                console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
        function updateStats(data) {
            document.getElementById('total-visits').textContent = data.visits || 0;
            document.getElementById('foodies-count').textContent = data.foodies?.length || 0;
            document.getElementById('drinkers-count').textContent = data.drinkers?.length || 0;
            document.getElementById('total-drinks').textContent =
                data.drinkers?.reduce((sum, d) => sum + d.count, 0) || 0;
            document.getElementById('vibe-votes').textContent = data.vibeVotes?.length || 0;

            // è®¡ç®—æ€»ç‚¹èµæ•°
            const totalLikes = data.memberLikes ? Object.values(data.memberLikes).reduce((sum, count) => sum + count, 0) : 0;
            document.getElementById('total-likes').textContent = totalLikes;

            // è®¡ç®—æ€»ç•™è¨€æ•°
            const totalComments = data.memberComments ?
                Object.values(data.memberComments).reduce((sum, comments) => sum + comments.length, 0) : 0;
            document.getElementById('total-comments').textContent = totalComments;
        }
        
        // æ›´æ–°å°é¦‹çŒ«åˆ—è¡¨
        function updateFoodiesList(foodies) {
            const container = document.getElementById('foodies-list');
            if (!foodies || foodies.length === 0) {
                container.innerHTML = '<p style="opacity: 0.6;">æš‚æ— æ•°æ®</p>';
                return;
            }
            container.innerHTML = foodies.map(name => `<span class="list-item" style="display: inline-block; margin: 5px;">ğŸ± ${name}</span>`).join('');
        }
        
        // æ›´æ–°é€ƒé…’æ’è¡Œæ¦œ
        function updateDrinkersTable(drinkers) {
            const tbody = document.querySelector('#drinkers-table tbody');
            if (!drinkers || drinkers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; opacity: 0.6;">æš‚æ— æ•°æ®</td></tr>';
                return;
            }
            
            const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
            tbody.innerHTML = drinkers.map((drinker, index) => `
                <tr>
                    <td>${index < 3 ? medals[index] : `#${index + 1}`}</td>
                    <td>${drinker.name}</td>
                    <td>${drinker.count} æ¯</td>
                </tr>
            `).join('');
        }
        
        // æ›´æ–° Vibe æŠ•ç¥¨
        function updateVibeVotes(vibeVotes) {
            if (!vibeVotes || vibeVotes.length === 0) {
                document.getElementById('vibe-chart').innerHTML = '<p style="opacity: 0.6;">æš‚æ— æ•°æ®</p>';
                document.querySelector('#vibe-table tbody').innerHTML = '<tr><td colspan="3" style="text-align: center; opacity: 0.6;">æš‚æ— æ•°æ®</td></tr>';
                return;
            }

            // ç»Ÿè®¡æ¯ä¸ª vibe çš„ç¥¨æ•°
            const vibeStats = {
                'ğŸº Drinking Games': { voters: [], count: 0 },
                'ğŸƒ Card Games': { voters: [], count: 0 },
                'ğŸ² Board Games': { voters: [], count: 0 },
                'ğŸ® Video Games': { voters: [], count: 0 },
                'ğŸ›‹ï¸ Just Chilling': { voters: [], count: 0 }
            };

            vibeVotes.forEach(({ name, vibes }) => {
                vibes.forEach(vibe => {
                    if (vibeStats[vibe]) {
                        vibeStats[vibe].voters.push(name);
                        vibeStats[vibe].count++;
                    }
                });
            });

            // æ›´æ–°æŸ±çŠ¶å›¾
            const maxCount = Math.max(...Object.values(vibeStats).map(s => s.count));
            const chartHTML = Object.entries(vibeStats)
                .sort((a, b) => b[1].count - a[1].count)
                .map(([vibe, stats]) => {
                    const percentage = maxCount > 0 ? (stats.count / maxCount) * 100 : 0;
                    return `
                        <div class="bar-item">
                            <div class="bar-label">${vibe}</div>
                            <div class="bar-visual" style="width: ${percentage}%;">
                                <div class="bar-value">${stats.count}ç¥¨</div>
                            </div>
                        </div>
                    `;
                }).join('');
            document.getElementById('vibe-chart').innerHTML = chartHTML;

            // æ›´æ–°è¡¨æ ¼
            const tableHTML = Object.entries(vibeStats)
                .sort((a, b) => b[1].count - a[1].count)
                .map(([vibe, stats]) => `
                    <tr>
                        <td><strong>${vibe}</strong></td>
                        <td>${stats.voters.join(', ') || 'æ— '}</td>
                        <td>${stats.count}ç¥¨</td>
                    </tr>
                `).join('');
            document.querySelector('#vibe-table tbody').innerHTML = tableHTML;
        }

        // æ›´æ–°å›¢é˜Ÿæˆå‘˜ç‚¹èµ
        function updateMemberLikes(memberLikes, memberComments) {
            const tbody = document.querySelector('#member-likes-table tbody');

            const memberNames = {
                'yudi': 'Yudi (DJ)',
                'noah': 'Noah (å¤§å¨)',
                'krystal': 'Krystal (ææ‹‰ç±³è‹å¤§å¸ˆ)',
                'lizhehao': 'æå“²è±ª (è°ƒé…’å¸ˆ)',
                'geyuxin': 'è‘›è¯­æ­† (æ‘„å½±å¸ˆ)',
                'weston': 'Weston Fang (AcademicæŒ‡å¯¼)',
                'sherry': 'Sherry Hua (é€ƒé…’ç»éªŒ)',
                'frank': 'Frank (å¥èº«æ•™ç»ƒ)',
                'kimi': 'Kimi (è¥å…»å¸ˆ)',
                'carrie': 'Carrie (æŠ½çš®æ¡å¤§ç‹)',
                'zhangtianen': 'å¼ å¤©æ© (ç½‘çº¢)',
                'ishan': 'Ishan (å°åº¦è¯­)',
                'lianshuitian': 'è¿æ°´å¤© (å¥¶èŒ¶å¤§ç‹)',
                'jessica': 'Jessica (ç‚’è‚¡)'
            };

            // åˆ›å»ºæˆå‘˜æ•°æ®æ•°ç»„
            const memberData = Object.keys(memberNames).map(id => ({
                id,
                name: memberNames[id],
                likes: memberLikes?.[id] || 0,
                comments: memberComments?.[id]?.length || 0
            }));

            // æŒ‰ç‚¹èµæ•°æ’åº
            memberData.sort((a, b) => b.likes - a.likes);

            const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
            const html = memberData.map((member, index) => `
                <tr>
                    <td>${index < 3 ? medals[index] : `#${index + 1}`}</td>
                    <td>${member.name}</td>
                    <td>ğŸ‘ ${member.likes}</td>
                    <td>ğŸ’¬ ${member.comments}</td>
                    <td>
                        <button onclick="viewMemberComments('${member.id}')" class="btn" style="padding: 5px 10px; font-size: 0.85rem;">
                            æŸ¥çœ‹ç•™è¨€
                        </button>
                    </td>
                </tr>
            `).join('');

            tbody.innerHTML = html || '<tr><td colspan="5" style="text-align: center; opacity: 0.6;">æš‚æ— æ•°æ®</td></tr>';

            // æ›´æ–°æˆå‘˜ç­›é€‰ä¸‹æ‹‰æ¡†
            const select = document.getElementById('member-filter');
            select.innerHTML = '<option value="">å…¨éƒ¨æˆå‘˜</option>' +
                memberData.map(m => `<option value="${m.id}">${m.name} (${m.comments}æ¡ç•™è¨€)</option>`).join('');
        }

        // æ›´æ–°å›¢é˜Ÿæˆå‘˜ç•™è¨€
        function updateMemberComments(memberComments) {
            window.allComments = memberComments || {};
            filterComments();
        }

        // ç­›é€‰ç•™è¨€
        function filterComments() {
            const container = document.getElementById('comments-container');
            const selectedMember = document.getElementById('member-filter').value;

            if (!window.allComments || Object.keys(window.allComments).length === 0) {
                container.innerHTML = '<p style="opacity: 0.6; text-align: center;">æš‚æ— ç•™è¨€</p>';
                return;
            }

            const memberNames = {
                'yudi': 'Yudi (DJ)',
                'noah': 'Noah (å¤§å¨)',
                'krystal': 'Krystal (ææ‹‰ç±³è‹å¤§å¸ˆ)',
                'lizhehao': 'æå“²è±ª (è°ƒé…’å¸ˆ)',
                'geyuxin': 'è‘›è¯­æ­† (æ‘„å½±å¸ˆ)',
                'weston': 'Weston Fang (AcademicæŒ‡å¯¼)',
                'sherry': 'Sherry Hua (é€ƒé…’ç»éªŒ)',
                'frank': 'Frank (å¥èº«æ•™ç»ƒ)',
                'kimi': 'Kimi (è¥å…»å¸ˆ)',
                'carrie': 'Carrie (æŠ½çš®æ¡å¤§ç‹)',
                'zhangtianen': 'å¼ å¤©æ© (ç½‘çº¢)',
                'ishan': 'Ishan (å°åº¦è¯­)',
                'lianshuitian': 'è¿æ°´å¤© (å¥¶èŒ¶å¤§ç‹)',
                'jessica': 'Jessica (ç‚’è‚¡)'
            };

            let html = '';

            Object.entries(window.allComments).forEach(([memberId, comments]) => {
                if (selectedMember && memberId !== selectedMember) return;
                if (!comments || comments.length === 0) return;

                html += `
                    <div style="margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 15px;">
                        <h3 style="color: var(--accent); margin-bottom: 15px;">ğŸ’¬ ${memberNames[memberId] || memberId} (${comments.length}æ¡ç•™è¨€)</h3>
                        ${comments.map((comment, index) => `
                            <div style="padding: 15px; margin-bottom: 10px; background: rgba(255,255,255,0.03); border-radius: 10px; border-left: 3px solid var(--primary);">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <strong style="color: var(--accent);">${comment.author}</strong>
                                    <span style="opacity: 0.6; font-size: 0.85rem;">${new Date(comment.timestamp).toLocaleString('zh-CN')}</span>
                                </div>
                                <div style="opacity: 0.9;">${comment.text}</div>
                                <button onclick="deleteComment('${memberId}', ${index})" class="btn" style="margin-top: 10px; padding: 5px 10px; font-size: 0.8rem; background: rgba(255,0,0,0.3);">
                                    ğŸ—‘ï¸ åˆ é™¤
                                </button>
                            </div>
                        `).reverse().join('')}
                    </div>
                `;
            });

            container.innerHTML = html || '<p style="opacity: 0.6; text-align: center;">æš‚æ— ç•™è¨€</p>';
        }

        // æŸ¥çœ‹æˆå‘˜ç•™è¨€
        function viewMemberComments(memberId) {
            document.getElementById('member-filter').value = memberId;
            filterComments();
            document.getElementById('comments-container').scrollIntoView({ behavior: 'smooth' });
        }

        // åˆ é™¤ç•™è¨€
        async function deleteComment(memberId, commentIndex) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç•™è¨€å—ï¼Ÿ')) return;

            try {
                const comments = window.allComments[memberId];
                comments.splice(commentIndex, 1);

                const response = await fetch(`${API_URL}/member-comments`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ memberId, comments })
                });

                if (response.ok) {
                    alert('ç•™è¨€å·²åˆ é™¤ï¼');
                    refreshData();
                } else {
                    alert('åˆ é™¤å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }

        // æ›´æ–°æ¸¸æˆåå¥½
        function updateGamePreferences(preferences) {
            if (!preferences || preferences.length === 0) {
                document.getElementById('game-chart').innerHTML = '<p style="opacity: 0.6;">æš‚æ— æ•°æ®</p>';
                document.querySelector('#game-table tbody').innerHTML = '<tr><td colspan="2" style="text-align: center; opacity: 0.6;">æš‚æ— æ•°æ®</td></tr>';
                return;
            }

            // åˆ†ç»„ç»Ÿè®¡
            const grouped = {};
            preferences.forEach(({ name, preference }) => {
                if (!grouped[preference]) {
                    grouped[preference] = [];
                }
                grouped[preference].push(name);
            });

            // æ›´æ–°æŸ±çŠ¶å›¾
            const maxCount = Math.max(...Object.values(grouped).map(arr => arr.length));
            const chartHTML = Object.entries(grouped)
                .sort((a, b) => b[1].length - a[1].length)
                .map(([preference, names]) => {
                    const percentage = (names.length / maxCount) * 100;
                    return `
                        <div class="bar-item">
                            <div class="bar-label">${preference}</div>
                            <div class="bar-visual" style="width: ${percentage}%;">
                                <div class="bar-value">${names.length}äºº</div>
                            </div>
                        </div>
                    `;
                }).join('');
            document.getElementById('game-chart').innerHTML = chartHTML;

            // æ›´æ–°è¡¨æ ¼
            const tableHTML = Object.entries(grouped)
                .sort((a, b) => b[1].length - a[1].length)
                .map(([preference, names]) => `
                    <tr>
                        <td><strong>${preference}</strong> (${names.length}äºº)</td>
                        <td>${names.join(', ')}</td>
                    </tr>
                `).join('');
            document.querySelector('#game-table tbody').innerHTML = tableHTML;
        }
        
        // æ›´æ–°è®¿é—®å†å²
        function updateVisitsTable(visits) {
            const tbody = document.querySelector('#visits-table tbody');
            if (!visits || visits.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; opacity: 0.6;">æš‚æ— æ•°æ®</td></tr>';
                return;
            }
            
            const recentVisits = visits.slice(-10).reverse();
            tbody.innerHTML = recentVisits.map(visit => `
                <tr>
                    <td>${new Date(visit.timestamp).toLocaleString('zh-CN')}</td>
                    <td>${visit.ip}</td>
                    <td style="font-size: 0.85rem; opacity: 0.8;">${visit.userAgent?.substring(0, 50)}...</td>
                </tr>
            `).join('');
        }
        
        // å¯¼å‡ºæ•°æ®
        async function exportData() {
            try {
                const response = await fetch(`${API_URL}/admin/export`);
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `party-data-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                alert('æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
            } catch (error) {
                alert('å¯¼å‡ºå¤±è´¥: ' + error.message);
            }
        }
        
        // æ›´æ–°æ¸¸æˆç»„å±€ç»Ÿè®¡
        function updateGameLobbies(lobbies) {
            if (!lobbies || lobbies.length === 0) {
                document.getElementById('total-lobbies').textContent = '0';
                document.getElementById('total-lobby-participants').textContent = '0';
                document.getElementById('most-popular-game').textContent = '-';
                document.querySelector('#lobbies-table tbody').innerHTML = '<tr><td colspan="6" style="text-align: center; opacity: 0.6;">æš‚æ— ç»„å±€</td></tr>';
                return;
            }

            // ç»Ÿè®¡æ•°æ®
            const totalLobbies = lobbies.length;
            const totalParticipants = lobbies.reduce((sum, lobby) => sum + (lobby.participants?.length || 0), 0);

            // ç»Ÿè®¡æœ€çƒ­é—¨æ¸¸æˆ
            const gameCount = {};
            lobbies.forEach(lobby => {
                gameCount[lobby.game] = (gameCount[lobby.game] || 0) + 1;
            });
            const mostPopularGame = Object.keys(gameCount).reduce((a, b) => gameCount[a] > gameCount[b] ? a : b, '-');

            document.getElementById('total-lobbies').textContent = totalLobbies;
            document.getElementById('total-lobby-participants').textContent = totalParticipants;
            document.getElementById('most-popular-game').textContent = mostPopularGame;

            // æ¸²æŸ“è¡¨æ ¼
            const tbody = document.querySelector('#lobbies-table tbody');
            tbody.innerHTML = lobbies.map(lobby => `
                <tr>
                    <td>${lobby.game}</td>
                    <td>${lobby.organizer}</td>
                    <td>${lobby.time || '-'}</td>
                    <td>${lobby.participants?.length || 0} äºº</td>
                    <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                        ${lobby.participants?.join(', ') || '-'}
                    </td>
                    <td>
                        <button onclick="deleteLobbyAdmin('${lobby.id}')" class="btn" style="padding: 5px 10px; font-size: 0.8rem; background: rgba(255,0,0,0.3);">
                            ğŸ—‘ï¸ åˆ é™¤
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // ç®¡ç†å‘˜åˆ é™¤ç»„å±€
        async function deleteLobbyAdmin(lobbyId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç»„å±€å—ï¼Ÿ')) return;

            try {
                // è·å–ç»„å±€ä¿¡æ¯ä»¥éªŒè¯
                const response = await fetch(`${API_URL}/admin/full-data`);
                const data = await response.json();
                const lobby = data.gameLobbies?.find(l => l.id === lobbyId);

                if (!lobby) {
                    alert('ç»„å±€ä¸å­˜åœ¨ï¼');
                    return;
                }

                const deleteResponse = await fetch(`${API_URL}/game-lobbies/${lobbyId}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ organizer: lobby.organizer })
                });

                if (deleteResponse.ok) {
                    alert('ç»„å±€å·²åˆ é™¤ï¼');
                    refreshData();
                } else {
                    alert('åˆ é™¤å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }

        // æ¸…ç©ºæ•°æ®
        async function clearAllData() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                return;
            }

            if (!confirm('å†æ¬¡ç¡®è®¤ï¼šçœŸçš„è¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/admin/clear`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('æ•°æ®å·²æ¸…ç©ºï¼');
                    refreshData();
                } else {
                    alert('æ¸…ç©ºå¤±è´¥ï¼');
                }
            } catch (error) {
                alert('æ¸…ç©ºå¤±è´¥: ' + error.message);
            }
        }

        // ==================== å†…å®¹ç¼–è¾‘åŠŸèƒ½ ====================

        // åŠ è½½å†…å®¹ç”¨äºç¼–è¾‘
        async function loadContentForEditing() {
            try {
                // åŠ è½½æ•°æ®
                const response = await fetch(`${API_URL}/admin/full-data`);
                const data = await response.json();

                // ä»åç«¯åŠ è½½ Support æˆå‘˜ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
                if (data.supportMembers && data.supportMembers.length > 0) {
                    currentSupportMembers = data.supportMembers;
                } else {
                    // ä½¿ç”¨é»˜è®¤æˆå‘˜
                    currentSupportMembers = [
                        { id: 'geyuxin', name: '@è‘›è¯­æ­†', role: 'ğŸ“· CCDæ‘„å½±å¸ˆ', description: 'æ€»èƒ½å‘ç°åˆ«äººè‡ªæ‹éƒ½æ²¡æ³¨æ„åˆ°çš„åŒä¸‹å·´ã€‚', isDefault: true },
                        { id: 'westonfang', name: '@Professor Weston Fang', role: 'ğŸ“ AcademicæŒ‡å¯¼', description: 'æ­£åœ¨é€ ç«æ˜Ÿæ— äººæœº', isDefault: true },
                        { id: 'sherryhua', name: '@Sherry Hua', role: 'ğŸ¹ é€ƒé…’ç»éªŒåˆ†äº«', description: 'èƒ½ä»ä»»ä½•é…’å±€ä¸­ä¼˜é›…é€ƒé…’çš„Real Master', isDefault: true },
                        { id: 'frank', name: '@Frank @Henry @æ²ˆè‰ºå¦‚', role: 'ğŸ‹ï¸â€â™‚ï¸ å¥èº«æ•™ç»ƒ', description: 'è®©ä½ åˆé…¸åˆçˆ½ï¼Œæƒ³ç›´æ¥åœ¨æ—è¾¹çš„GYMåšä¸‰ç»„å§æ¨ã€‚', isDefault: true },
                        { id: 'kimi', name: '@Kimi', role: 'ğŸ¥‘ é«˜çº§è¥å…»å¸ˆ', description: 'ä¸€è¾¹è¯´å°‘åƒç¢³æ°´ï¼Œä¸€è¾¹å·å·å•ƒæ‰ä¸‰ä¸ªéº¦èŠ¬ã€‚ï¼ˆçœŸçš„å¤§å¨ï¼‰', isDefault: true },
                        { id: 'carrie', name: '@Carrie', role: 'ğŸ’… æŠ½çš®æ¡å¤§ç‹ å¯ä»¥ä»£æŠ½çš®æ¡', description: '"ä¸æ€•çš®åšï¼Œåªæ€•ä¸æŠ½ã€‚"', isDefault: true },
                        { id: 'zhangtianen', name: '@å¼ å¤©æ©', role: 'ğŸ“¸ ç½‘çº¢ç»éªŒåˆ†äº«', description: 'ç»å…¸åè¨€"æˆ‘ä»å°å°±çˆ±è¯´è„è¯"', isDefault: true },
                        { id: 'ishan', name: '@Ishan', role: 'ğŸ•‰ï¸ å°åº¦è¯­å­¦ä¹ ', description: 'ğŸ™ å•Škiè‹¦åŠ›hoyahobanï½', isDefault: true },
                        { id: 'lianshuitian', name: '@è¿æ°´å¤©', role: 'ğŸ§‹ å¥¶èŒ¶å¤§ç‹', description: 'ä¸€æ¯å…¨ç³–å°‘å†°ï¼Œç”œè¿‡ä½ çš„æ‹çˆ±å²ã€‚', isDefault: true },
                        { id: 'jessica', name: '@Jessica', role: 'ğŸ“ˆ ç‚’è‚¡', description: 'å¥¹çš„è‚¡ç¥¨èµ°åŠ¿å›¾çœ‹èµ·æ¥åƒå¿ƒç”µå›¾ã€‚', isDefault: true },
                        { id: 'racing', name: '@ä»»æ€¡é™', role: 'ğŸï¸ é£™è½¦ç»éªŒåˆ†äº«', description: 'çº¢ç¯ï¼Ÿä½ åˆ«é—¹äº†ğŸ˜', isDefault: true },
                        { id: 'church', name: '@Krystal @Thomas', role: 'ğŸ™ æ•™ä¼šç»éªŒåˆ†äº«', description: 'UNC æœ€æ¸©æŸ”ã€‚', isDefault: true },
                        { id: 'linguist', name: '@Zhongyu', role: 'ğŸ—£ï¸ è¯­è¨€å­¦å®¶', description: '"å†œ""æµ“"', isDefault: true }
                    ];
                }

                // ä»åç«¯åŠ è½½å¯¼èˆªèœå•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
                if (data.navMenuItems && data.navMenuItems.length > 0) {
                    currentNavMenuItems = data.navMenuItems;
                } else {
                    // ä½¿ç”¨é»˜è®¤å¯¼èˆªèœå•
                    currentNavMenuItems = [
                        { id: 'home', label: 'ğŸ  é¦–é¡µ', labelEn: 'ğŸ  Home', target: 'hero' },
                        { id: 'info', label: 'ğŸ“ æ´¾å¯¹ä¿¡æ¯', labelEn: 'ğŸ“ Party Info', target: 'info' },
                        { id: 'schedule', label: 'â° æ—¶é—´å®‰æ’', labelEn: 'â° Schedule', target: 'schedule' },
                        { id: 'team', label: 'âœ¨ æ´¾å¯¹å›¢é˜Ÿ', labelEn: 'âœ¨ Team', target: 'team' },
                        { id: 'foodies', label: 'ğŸ± å°é¦‹çŒ«åˆ—è¡¨', labelEn: 'ğŸ± Foodie List', target: 'foodies' },
                        { id: 'drinking', label: 'ğŸº é€ƒé…’æ’è¡Œæ¦œ', labelEn: 'ğŸº Drinking', target: 'drinking' },
                        { id: 'games', label: 'ğŸ® æ¸¸æˆ', labelEn: 'ğŸ® Games', target: 'games' }
                    ];
                }

                // ä»åç«¯åŠ è½½æ—¶é—´å®‰æ’ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
                if (data.timeline && data.timeline.length > 0) {
                    currentTimeline = data.timeline;
                } else {
                    // ä½¿ç”¨é»˜è®¤æ—¶é—´å®‰æ’
                    currentTimeline = [
                        { time: '7:30 PM', event: 'ğŸ° åˆ¶ä½œææ‹‰ç±³è‹ï¼ˆå¯¹åˆ¶ä½œææ‹‰ç±³è‹æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥æå‰æ¥ï¼‰' },
                        { time: '8:30 PM', event: 'ğŸ‰ æ´¾å¯¹æ­£å¼å¼€å§‹ğŸ˜' },
                        { time: '9:00 PM', event: 'ğŸœ å¤œå®µæ—¶é—´' },
                        { time: '10:00 PM', event: 'ğŸ® æ¸¸æˆæ—¶é—´' },
                        { time: '11:00 PM', event: 'ğŸµ Party Mode' }
                    ];
                }

                renderSupportMembersEditor();
                renderNavMenuList();
                renderTimelineEditor();
                renderCustomMembersList(data.customMembers || []);

                // åˆå§‹åŒ–æ´¾å¯¹ä¿¡æ¯è‡ªåŠ¨ä¿å­˜
                setTimeout(() => {
                    setupPartyInfoAutoSave();
                }, 100);
            } catch (error) {
                console.error('åŠ è½½ç¼–è¾‘å†…å®¹å¤±è´¥:', error);
            }
        }

        // ==================== Support æˆå‘˜ç®¡ç†ï¼ˆç´§å‡‘åˆ—è¡¨ + æ‹–æ‹½æ’åºï¼‰ ====================
        let currentEditingMemberIndex = null;

        // æ¸²æŸ“ Support æˆå‘˜åˆ—è¡¨
        function renderSupportMembersEditor() {
            const container = document.getElementById('support-members-list');
            const html = currentSupportMembers.map((member, index) => `
                <div class="compact-list-item" draggable="true" data-index="${index}">
                    <span class="drag-handle">â˜°</span>
                    <div class="item-info" onclick="openEditMemberModal(${index})">
                        <div class="item-name">${member.name}</div>
                        <div class="item-role">${member.role}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-icon" onclick="event.stopPropagation(); openEditMemberModal(${index})" title="ç¼–è¾‘">âœï¸</button>
                        <button class="btn-icon" onclick="event.stopPropagation(); deleteSupportMember(${index})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
            container.innerHTML = html;

            // æ·»åŠ æ‹–æ‹½äº‹ä»¶ç›‘å¬ï¼Œå¹¶æ·»åŠ è‡ªåŠ¨ä¿å­˜å›è°ƒ
            initDragAndDrop('support-members-list', currentSupportMembers, renderSupportMembersEditor, saveSupportMembersAuto);
        }

        // æ‰“å¼€ç¼–è¾‘æˆå‘˜æ¨¡æ€çª—å£
        function openEditMemberModal(index) {
            currentEditingMemberIndex = index;
            const member = currentSupportMembers[index];

            document.getElementById('edit-member-id').value = member.id || '';
            document.getElementById('edit-member-name').value = member.name || '';
            document.getElementById('edit-member-role').value = member.role || '';
            document.getElementById('edit-member-description').value = member.description || '';

            document.getElementById('edit-member-modal').classList.add('active');
        }

        // å…³é—­ç¼–è¾‘æˆå‘˜æ¨¡æ€çª—å£
        function closeEditMemberModal() {
            document.getElementById('edit-member-modal').classList.remove('active');
            currentEditingMemberIndex = null;
        }

        // ä¿å­˜ç¼–è¾‘çš„æˆå‘˜
        function saveEditedMember() {
            if (currentEditingMemberIndex === null) return;

            currentSupportMembers[currentEditingMemberIndex] = {
                ...currentSupportMembers[currentEditingMemberIndex],
                id: document.getElementById('edit-member-id').value,
                name: document.getElementById('edit-member-name').value,
                role: document.getElementById('edit-member-role').value,
                description: document.getElementById('edit-member-description').value
            };

            renderSupportMembersEditor();
            closeEditMemberModal();

            // è‡ªåŠ¨ä¿å­˜
            setTimeout(() => {
                saveSupportMembersAuto();
            }, 300);
        }

        // åˆ é™¤ Support æˆå‘˜
        function deleteSupportMember(index) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæˆå‘˜å—ï¼Ÿ')) return;
            currentSupportMembers.splice(index, 1);
            renderSupportMembersEditor();
        }

        // æ·»åŠ  Support æˆå‘˜
        function addSupportMember() {
            const newMember = {
                id: 'new_' + Date.now(),
                name: '@æ–°æˆå‘˜',
                role: 'ğŸ¯ è§’è‰²',
                description: 'æè¿°',
                isDefault: true
            };
            currentSupportMembers.push(newMember);
            renderSupportMembersEditor();
            // è‡ªåŠ¨æ‰“å¼€ç¼–è¾‘çª—å£
            setTimeout(() => openEditMemberModal(currentSupportMembers.length - 1), 100);
        }

        // ä¿å­˜ Support æˆå‘˜ï¼ˆæ‰‹åŠ¨ä¿å­˜ï¼‰
        async function saveSupportMembers() {
            if (!confirm('ç¡®å®šè¦ä¿å­˜æˆå‘˜ä¿¡æ¯å—ï¼Ÿ')) return;

            try {
                const response = await fetch(`${API_URL}/support-members`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ members: currentSupportMembers })
                });

                if (response.ok) {
                    alert('âœ… æˆå‘˜ä¿¡æ¯å·²ä¿å­˜ï¼');
                    refreshData();
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        // è‡ªåŠ¨ä¿å­˜ Support æˆå‘˜ï¼ˆæ— æç¤ºï¼‰
        async function saveSupportMembersAuto() {
            try {
                console.log('ğŸ“¤ æ­£åœ¨ä¿å­˜ Support æˆå‘˜é¡ºåº:', currentSupportMembers.map(m => m.name));
                const response = await fetch(`${API_URL}/support-members`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ members: currentSupportMembers })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('âœ… æˆå‘˜ä¿¡æ¯å·²è‡ªåŠ¨ä¿å­˜:', result);
                    showAutoSaveNotification('âœ… æˆå‘˜é¡ºåºå·²è‡ªåŠ¨ä¿å­˜');
                } else {
                    console.error('âŒ è‡ªåŠ¨ä¿å­˜å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);
                }
            } catch (error) {
                console.error('âŒ è‡ªåŠ¨ä¿å­˜å¤±è´¥:', error);
            }
        }

        // ==================== å¯¼èˆªèœå•ç®¡ç† ====================
        let currentNavMenuItems = [];
        let currentEditingNavIndex = null;

        // æ¸²æŸ“å¯¼èˆªèœå•åˆ—è¡¨
        function renderNavMenuList() {
            const container = document.getElementById('nav-menu-list');
            const html = currentNavMenuItems.map((item, index) => `
                <div class="compact-list-item" draggable="true" data-index="${index}">
                    <span class="drag-handle">â˜°</span>
                    <div class="item-info" onclick="openEditNavModal(${index})">
                        <div class="item-name">${item.label}</div>
                        <div class="item-role">${item.labelEn} â†’ #${item.target}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-icon" onclick="event.stopPropagation(); openEditNavModal(${index})" title="ç¼–è¾‘">âœï¸</button>
                    </div>
                </div>
            `).join('');
            container.innerHTML = html;

            // æ·»åŠ æ‹–æ‹½äº‹ä»¶ç›‘å¬ï¼Œå¹¶æ·»åŠ è‡ªåŠ¨ä¿å­˜å›è°ƒ
            initDragAndDrop('nav-menu-list', currentNavMenuItems, renderNavMenuList, saveNavMenuAuto);
        }

        // æ‰“å¼€ç¼–è¾‘å¯¼èˆªèœå•æ¨¡æ€çª—å£
        function openEditNavModal(index) {
            currentEditingNavIndex = index;
            const item = currentNavMenuItems[index];

            document.getElementById('edit-nav-label').value = item.label || '';
            document.getElementById('edit-nav-label-en').value = item.labelEn || '';
            document.getElementById('edit-nav-target').value = item.target || '';

            document.getElementById('edit-nav-modal').classList.add('active');
        }

        // å…³é—­ç¼–è¾‘å¯¼èˆªèœå•æ¨¡æ€çª—å£
        function closeEditNavModal() {
            document.getElementById('edit-nav-modal').classList.remove('active');
            currentEditingNavIndex = null;
        }

        // ä¿å­˜ç¼–è¾‘çš„å¯¼èˆªèœå•é¡¹
        function saveEditedNavItem() {
            if (currentEditingNavIndex === null) return;

            currentNavMenuItems[currentEditingNavIndex] = {
                ...currentNavMenuItems[currentEditingNavIndex],
                label: document.getElementById('edit-nav-label').value,
                labelEn: document.getElementById('edit-nav-label-en').value,
                target: document.getElementById('edit-nav-target').value
            };

            renderNavMenuList();
            closeEditNavModal();

            // è‡ªåŠ¨ä¿å­˜
            setTimeout(() => {
                saveNavMenuAuto();
            }, 300);
        }

        // ä¿å­˜å¯¼èˆªèœå•ï¼ˆæ‰‹åŠ¨ä¿å­˜ï¼‰
        async function saveNavMenu() {
            if (!confirm('ç¡®å®šè¦ä¿å­˜å¯¼èˆªèœå•å—ï¼Ÿ')) return;

            try {
                const response = await fetch(`${API_URL}/nav-menu`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ navMenuItems: currentNavMenuItems })
                });

                if (response.ok) {
                    alert('âœ… å¯¼èˆªèœå•å·²ä¿å­˜ï¼');
                    refreshData();
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        // è‡ªåŠ¨ä¿å­˜å¯¼èˆªèœå•ï¼ˆæ— æç¤ºï¼‰
        async function saveNavMenuAuto() {
            try {
                console.log('ğŸ“¤ æ­£åœ¨ä¿å­˜å¯¼èˆªèœå•é¡ºåº:', currentNavMenuItems.map(m => m.label));
                const response = await fetch(`${API_URL}/nav-menu`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ navMenuItems: currentNavMenuItems })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('âœ… å¯¼èˆªèœå•å·²è‡ªåŠ¨ä¿å­˜:', result);
                    showAutoSaveNotification('âœ… èœå•é¡ºåºå·²è‡ªåŠ¨ä¿å­˜');
                } else {
                    console.error('âŒ è‡ªåŠ¨ä¿å­˜å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);
                }
            } catch (error) {
                console.error('âŒ è‡ªåŠ¨ä¿å­˜å¤±è´¥:', error);
            }
        }

        // ==================== æ‹–æ‹½æ’åºé€šç”¨å‡½æ•°ï¼ˆæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡ï¼‰ ====================
        const dragState = {};

        function initDragAndDrop(containerId, dataArray, renderCallback, saveCallback) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            if (dragState[containerId]) {
                const oldContainer = dragState[containerId].container;
                oldContainer.removeEventListener('dragstart', dragState[containerId].dragstart);
                oldContainer.removeEventListener('dragend', dragState[containerId].dragend);
                oldContainer.removeEventListener('dragover', dragState[containerId].dragover);
                oldContainer.removeEventListener('drop', dragState[containerId].drop);
                oldContainer.removeEventListener('touchstart', dragState[containerId].touchstart);
                oldContainer.removeEventListener('touchmove', dragState[containerId].touchmove);
                oldContainer.removeEventListener('touchend', dragState[containerId].touchend);
            }

            let draggedElement = null;
            let draggedIndex = null;
            let touchStartY = 0;

            // ========== æ¡Œé¢æ‹–æ‹½äº‹ä»¶ ==========
            const dragstartHandler = (e) => {
                if (e.target.classList.contains('compact-list-item')) {
                    draggedElement = e.target;
                    draggedIndex = parseInt(e.target.dataset.index);
                    e.target.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                }
            };

            const dragendHandler = (e) => {
                if (e.target.classList.contains('compact-list-item')) {
                    e.target.classList.remove('dragging');
                }
            };

            const dragoverHandler = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                const afterElement = getDragAfterElement(container, e.clientY);
                const dragging = container.querySelector('.dragging');

                if (afterElement == null) {
                    container.appendChild(dragging);
                } else {
                    container.insertBefore(dragging, afterElement);
                }
            };

            const dropHandler = (e) => {
                e.preventDefault();
                finalizeDragAndDrop();
            };

            // ========== ç§»åŠ¨è®¾å¤‡è§¦æ‘¸äº‹ä»¶ ==========
            const touchstartHandler = (e) => {
                const item = e.target.closest('.compact-list-item');
                if (item) {
                    draggedElement = item;
                    draggedIndex = parseInt(item.dataset.index);
                    touchStartY = e.touches[0].clientY;
                    item.classList.add('dragging');
                }
            };

            const touchmoveHandler = (e) => {
                if (!draggedElement) return;
                e.preventDefault();

                const touchY = e.touches[0].clientY;
                const afterElement = getDragAfterElement(container, touchY);
                const dragging = container.querySelector('.dragging');

                if (afterElement == null) {
                    container.appendChild(dragging);
                } else {
                    container.insertBefore(dragging, afterElement);
                }
            };

            const touchendHandler = (e) => {
                if (draggedElement) {
                    draggedElement.classList.remove('dragging');
                    finalizeDragAndDrop();
                }
            };

            // å®Œæˆæ‹–æ‹½æ“ä½œ
            function finalizeDragAndDrop() {
                // è·å–å½“å‰ DOM ä¸­çš„é¡ºåº
                const items = Array.from(container.querySelectorAll('.compact-list-item'));

                // æ ¹æ® DOM é¡ºåºé‡æ–°æ’åˆ—æ•°æ®æ•°ç»„
                const reorderedArray = items.map((item) => {
                    const index = parseInt(item.dataset.index);
                    return dataArray[index];
                });

                // æ›´æ–°åŸæ•°ç»„
                dataArray.length = 0;
                dataArray.push(...reorderedArray);

                // é‡æ–°æ¸²æŸ“ï¼ˆè¿™ä¼šæ›´æ–° data-indexï¼‰
                renderCallback();

                // è‡ªåŠ¨ä¿å­˜
                if (saveCallback) {
                    setTimeout(() => {
                        saveCallback();
                    }, 300);
                }

                draggedElement = null;
                draggedIndex = null;
            }

            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            container.addEventListener('dragstart', dragstartHandler);
            container.addEventListener('dragend', dragendHandler);
            container.addEventListener('dragover', dragoverHandler);
            container.addEventListener('drop', dropHandler);
            container.addEventListener('touchstart', touchstartHandler, false);
            container.addEventListener('touchmove', touchmoveHandler, false);
            container.addEventListener('touchend', touchendHandler, false);

            // ä¿å­˜äº‹ä»¶å¤„ç†å™¨ä»¥ä¾¿åç»­ç§»é™¤
            dragState[containerId] = {
                container,
                dragstart: dragstartHandler,
                dragend: dragendHandler,
                dragover: dragoverHandler,
                drop: dropHandler,
                touchstart: touchstartHandler,
                touchmove: touchmoveHandler,
                touchend: touchendHandler
            };
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.compact-list-item:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;

                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // æ¸²æŸ“æ—¶é—´å®‰æ’ç¼–è¾‘å™¨
        function renderTimelineEditor() {
            const container = document.getElementById('timeline-editor');
            const html = currentTimeline.map((item, index) => `
                <div class="edit-form" id="timeline-item-${index}" style="margin-bottom: 15px;">
                    <div style="display: grid; grid-template-columns: 150px 1fr auto; gap: 15px; align-items: start;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>æ—¶é—´</label>
                            <input type="text" value="${item.time}" oninput="updateTimelineItem(${index}, 'time', this.value)">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>äº‹ä»¶</label>
                            <input type="text" value="${item.event}" oninput="updateTimelineItem(${index}, 'event', this.value)">
                        </div>
                        <div style="padding-top: 28px;">
                            <button onclick="deleteTimelineItem(${index})" class="btn btn-danger btn-small">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                </div>
            `).join('');
            container.innerHTML = html;
        }

        // æ—¶é—´å®‰æ’è‡ªåŠ¨ä¿å­˜å®šæ—¶å™¨
        let timelineAutoSaveTimer = null;

        // æ›´æ–°æ—¶é—´å®‰æ’é¡¹ï¼ˆå®æ—¶æ›´æ–°ï¼‰
        function updateTimelineItem(index, field, value) {
            currentTimeline[index][field] = value;

            // æ·»åŠ è§†è§‰åé¦ˆ
            const item = document.getElementById(`timeline-item-${index}`);
            if (item) {
                item.style.border = '2px solid #fbbf24';
                setTimeout(() => {
                    item.style.border = '1px solid rgba(255, 255, 255, 0.1)';
                }, 500);
            }

            // è‡ªåŠ¨ä¿å­˜
            clearTimeout(timelineAutoSaveTimer);
            timelineAutoSaveTimer = setTimeout(() => {
                saveTimelineAuto();
            }, 1500); // 1.5ç§’åè‡ªåŠ¨ä¿å­˜
        }

        // åˆ é™¤æ—¶é—´å®‰æ’é¡¹
        function deleteTimelineItem(index) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ—¶é—´ç‚¹å—ï¼Ÿ')) return;
            currentTimeline.splice(index, 1);
            renderTimelineEditor();
        }

        // æ·»åŠ æ—¶é—´å®‰æ’é¡¹
        function addTimelineItem() {
            currentTimeline.push({ time: '12:00 AM', event: 'æ–°äº‹ä»¶' });
            renderTimelineEditor();
        }

        // ä¿å­˜æ—¶é—´å®‰æ’ï¼ˆæ‰‹åŠ¨ä¿å­˜ï¼‰
        async function saveTimeline() {
            if (!confirm('ç¡®å®šè¦ä¿å­˜æ—¶é—´å®‰æ’å—ï¼Ÿ')) return;

            try {
                const response = await fetch(`${API_URL}/timeline`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ timeline: currentTimeline })
                });

                if (response.ok) {
                    alert('âœ… æ—¶é—´å®‰æ’å·²ä¿å­˜ï¼');
                    refreshData();
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        // è‡ªåŠ¨ä¿å­˜æ—¶é—´å®‰æ’ï¼ˆæ— æç¤ºï¼‰
        async function saveTimelineAuto() {
            try {
                const response = await fetch(`${API_URL}/timeline`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ timeline: currentTimeline })
                });

                if (response.ok) {
                    console.log('âœ… æ—¶é—´å®‰æ’å·²è‡ªåŠ¨ä¿å­˜');
                    showAutoSaveNotification('âœ… æ—¶é—´å®‰æ’å·²è‡ªåŠ¨ä¿å­˜');
                } else {
                    console.error('âŒ è‡ªåŠ¨ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                console.error('âŒ è‡ªåŠ¨ä¿å­˜å¤±è´¥:', error);
            }
        }

        // è‡ªåŠ¨ä¿å­˜æ´¾å¯¹ä¿¡æ¯çš„å®šæ—¶å™¨
        let partyInfoAutoSaveTimer = null;

        // ä¸ºæ´¾å¯¹ä¿¡æ¯è¾“å…¥æ¡†æ·»åŠ è‡ªåŠ¨ä¿å­˜ç›‘å¬
        function setupPartyInfoAutoSave() {
            const inputs = ['edit-party-title', 'edit-party-date', 'edit-party-time', 'edit-party-address', 'edit-party-phone'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', () => {
                        clearTimeout(partyInfoAutoSaveTimer);
                        partyInfoAutoSaveTimer = setTimeout(() => {
                            savePartyInfoAuto();
                        }, 1500); // 1.5ç§’åè‡ªåŠ¨ä¿å­˜
                    });
                }
            });
        }

        // ä¿å­˜æ´¾å¯¹åŸºæœ¬ä¿¡æ¯ï¼ˆæ‰‹åŠ¨ä¿å­˜ï¼‰
        async function savePartyInfo() {
            if (!confirm('ç¡®å®šè¦ä¿å­˜æ´¾å¯¹ä¿¡æ¯å—ï¼Ÿ')) return;

            const info = {
                title: document.getElementById('edit-party-title').value,
                date: document.getElementById('edit-party-date').value,
                time: document.getElementById('edit-party-time').value,
                address: document.getElementById('edit-party-address').value,
                phone: document.getElementById('edit-party-phone').value
            };

            try {
                const response = await fetch(`${API_URL}/party-info`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(info)
                });

                if (response.ok) {
                    alert('âœ… æ´¾å¯¹ä¿¡æ¯å·²ä¿å­˜ï¼');
                    refreshData();
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        // è‡ªåŠ¨ä¿å­˜æ´¾å¯¹åŸºæœ¬ä¿¡æ¯ï¼ˆæ— æç¤ºï¼‰
        async function savePartyInfoAuto() {
            const info = {
                title: document.getElementById('edit-party-title').value,
                date: document.getElementById('edit-party-date').value,
                time: document.getElementById('edit-party-time').value,
                address: document.getElementById('edit-party-address').value,
                phone: document.getElementById('edit-party-phone').value
            };

            try {
                const response = await fetch(`${API_URL}/party-info`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(info)
                });

                if (response.ok) {
                    console.log('âœ… æ´¾å¯¹ä¿¡æ¯å·²è‡ªåŠ¨ä¿å­˜');
                    showAutoSaveNotification('âœ… æ´¾å¯¹ä¿¡æ¯å·²è‡ªåŠ¨ä¿å­˜');
                } else {
                    console.error('âŒ è‡ªåŠ¨ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                console.error('âŒ è‡ªåŠ¨ä¿å­˜å¤±è´¥:', error);
            }
        }

        // æ¸²æŸ“è‡ªå®šä¹‰æˆå‘˜åˆ—è¡¨
        function renderCustomMembersList(customMembers) {
            const container = document.getElementById('custom-members-list');
            if (!customMembers || customMembers.length === 0) {
                container.innerHTML = '<p style="opacity: 0.6; text-align: center;">æš‚æ— è‡ªå®šä¹‰æˆå‘˜</p>';
                return;
            }

            const html = customMembers.map(member => `
                <div class="member-card-edit">
                    <div class="member-info">
                        <p><strong>åå­—:</strong> ${member.name}</p>
                        <p><strong>è§’è‰²:</strong> ${member.role}</p>
                        <p><strong>åˆ†ç±»:</strong> ${member.category || 'support'}</p>
                        ${member.description ? `<p><strong>æè¿°:</strong> ${member.description}</p>` : ''}
                    </div>
                    <div class="member-actions">
                        <button onclick="deleteCustomMember('${member.id}')" class="btn btn-danger btn-small">ğŸ—‘ï¸ åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
            container.innerHTML = html;
        }

        // åˆ é™¤è‡ªå®šä¹‰æˆå‘˜
        async function deleteCustomMember(memberId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè‡ªå®šä¹‰æˆå‘˜å—ï¼Ÿ')) return;

            try {
                const data = window.currentData;
                data.customMembers = data.customMembers.filter(m => m.id !== memberId);

                const response = await fetch(`${API_URL}/custom-members`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ customMembers: data.customMembers })
                });

                if (response.ok) {
                    alert('è‡ªå®šä¹‰æˆå‘˜å·²åˆ é™¤ï¼');
                    loadContentForEditing();
                } else {
                    alert('åˆ é™¤å¤±è´¥ï¼');
                }
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }
    </script>
</body>
</html>
