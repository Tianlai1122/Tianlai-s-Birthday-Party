# ğŸ†˜ Supabase æ•…éšœæ’é™¤æŒ‡å—

é‡åˆ°é—®é¢˜ï¼Ÿè¿™ä¸ªæŒ‡å—ä¼šå¸®ä½ è§£å†³ï¼

---

## âŒ é—®é¢˜ 1ï¼šRender æ—¥å¿—æ˜¾ç¤º "Supabase è¿æ¥å¤±è´¥"

### ç—‡çŠ¶

```
âŒ Supabase è¿æ¥å¤±è´¥ï¼Œé™çº§ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿ
âš ï¸  æœªé…ç½® SUPABASE_URL æˆ– SUPABASE_KEY
```

### åŸå› 

ç¯å¢ƒå˜é‡é…ç½®ä¸æ­£ç¡®æˆ–ä¸å®Œæ•´ã€‚

### è§£å†³æ–¹æ¡ˆ

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ç¯å¢ƒå˜é‡**

1. ç™»å½• Render Dashboard
2. ç‚¹å‡»ä½ çš„åç«¯æœåŠ¡
3. ç‚¹å‡» "Environment"
4. æ£€æŸ¥æ˜¯å¦æœ‰è¿™ä¸¤ä¸ªå˜é‡ï¼š
   - `SUPABASE_URL`
   - `SUPABASE_KEY`

**æ­¥éª¤ 2ï¼šæ£€æŸ¥å€¼æ˜¯å¦æ­£ç¡®**

- SUPABASE_URL åº”è¯¥æ˜¯ï¼š`https://xxxxxxxxxxxxx.supabase.co`
- SUPABASE_KEY åº”è¯¥æ˜¯ï¼šä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œä»¥ `eyJ` å¼€å¤´

**æ­¥éª¤ 3ï¼šæ£€æŸ¥æ˜¯å¦æœ‰å¤šä½™ç©ºæ ¼**

- å¤åˆ¶æ—¶å¯èƒ½ä¼šå¸¦ä¸Šå¤šä½™çš„ç©ºæ ¼
- åˆ é™¤æ‰€æœ‰å¤šä½™çš„ç©ºæ ¼å’Œæ¢è¡Œç¬¦
- ç¡®ä¿å€¼å®Œå…¨åŒ¹é…

**æ­¥éª¤ 4ï¼šé‡æ–°å¤åˆ¶å‡­è¯**

å¦‚æœä¸ç¡®å®šï¼Œé‡æ–°ä» Supabase å¤åˆ¶ï¼š

1. ç™»å½• Supabase Dashboard
2. ç‚¹å‡» Settings â†’ API
3. é‡æ–°å¤åˆ¶ Project URL å’Œ API Key
4. åœ¨ Render ä¸­æ›´æ–°ç¯å¢ƒå˜é‡
5. ç­‰å¾…é‡æ–°éƒ¨ç½²

**æ­¥éª¤ 5ï¼šæ£€æŸ¥éƒ¨ç½²çŠ¶æ€**

1. åœ¨ Render ä¸­ï¼Œç‚¹å‡» "Deployments"
2. æŸ¥çœ‹æœ€æ–°çš„éƒ¨ç½²æ˜¯å¦æˆåŠŸ
3. å¦‚æœå¤±è´¥ï¼Œç‚¹å‡»æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

---

## âŒ é—®é¢˜ 2ï¼šè¡¨ä¸å­˜åœ¨é”™è¯¯

### ç—‡çŠ¶

```
Error: relation "party_data" does not exist
```

### åŸå› 

Supabase ä¸­æ²¡æœ‰åˆ›å»º `party_data` è¡¨ï¼Œæˆ–è¡¨åä¸åŒ¹é…ã€‚

### è§£å†³æ–¹æ¡ˆ

**æ­¥éª¤ 1ï¼šæ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨**

1. ç™»å½• Supabase Dashboard
2. ç‚¹å‡» "Table Editor"
3. æŸ¥çœ‹å·¦ä¾§æ˜¯å¦æœ‰ `party_data` è¡¨

**æ­¥éª¤ 2ï¼šå¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒ**

1. ç‚¹å‡» "Create a new table"
2. Name: `party_data`
3. **å–æ¶ˆå‹¾é€‰** "Enable Row Level Security (RLS)"
4. ç‚¹å‡» "Create table"

**æ­¥éª¤ 3ï¼šæ·»åŠ åˆ—**

1. åˆ é™¤é»˜è®¤çš„ `id` åˆ—ï¼ˆuuid ç±»å‹ï¼‰
2. æ·»åŠ  `id` åˆ—ï¼ˆtext ç±»å‹ï¼ŒPrimary Keyï¼‰
3. æ·»åŠ  `data` åˆ—ï¼ˆjsonb ç±»å‹ï¼‰
4. æ·»åŠ  `updated_at` åˆ—ï¼ˆtimestamptz ç±»å‹ï¼ŒDefault: now()ï¼‰

**æ­¥éª¤ 4ï¼šæ’å…¥åˆå§‹æ•°æ®**

1. ç‚¹å‡» "Insert row"
2. åœ¨ `id` å­—æ®µè¾“å…¥ï¼š`main`
3. åœ¨ `data` å­—æ®µè¾“å…¥åˆå§‹ JSON
4. ç‚¹å‡» "Save"

**æ­¥éª¤ 5ï¼šé‡æ–°éƒ¨ç½²**

1. å›åˆ° Render
2. ç‚¹å‡» "Manual Deploy"
3. ç­‰å¾…é‡æ–°éƒ¨ç½²å®Œæˆ

---

## âŒ é—®é¢˜ 3ï¼šæ•°æ®æ²¡æœ‰ä¿å­˜

### ç—‡çŠ¶

- åœ¨ç½‘ç«™ä¸Šæ·»åŠ æ•°æ®åï¼Œåˆ·æ–°é¡µé¢æ•°æ®æ¶ˆå¤±
- Supabase è¡¨ä¸­æ²¡æœ‰çœ‹åˆ°æ–°æ•°æ®

### åŸå› 

1. Supabase è¿æ¥å¤±è´¥
2. RLS æƒé™é—®é¢˜
3. è¡¨ç»“æ„ä¸æ­£ç¡®

### è§£å†³æ–¹æ¡ˆ

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ Render æ—¥å¿—**

1. ç™»å½• Render Dashboard
2. ç‚¹å‡»ä½ çš„åç«¯æœåŠ¡
3. ç‚¹å‡» "Logs"
4. æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

**æ­¥éª¤ 2ï¼šæ£€æŸ¥ RLS æ˜¯å¦ç¦ç”¨**

1. ç™»å½• Supabase Dashboard
2. ç‚¹å‡» "Table Editor"
3. é€‰æ‹© `party_data` è¡¨
4. ç‚¹å‡»è¡¨åå³è¾¹çš„ä¸‰ä¸ªç‚¹ "..."
5. é€‰æ‹© "Edit table"
6. ç¡®ä¿ "Enable Row Level Security (RLS)" æ˜¯**æœªå‹¾é€‰**çš„

**æ­¥éª¤ 3ï¼šæ£€æŸ¥è¡¨ç»“æ„**

1. åœ¨ Table Editor ä¸­ï¼ŒæŸ¥çœ‹ `party_data` è¡¨çš„åˆ—
2. åº”è¯¥æœ‰ï¼š
   - `id` (text, Primary Key)
   - `data` (jsonb)
   - `updated_at` (timestamptz)

**æ­¥éª¤ 4ï¼šæ‰‹åŠ¨æµ‹è¯•**

1. åœ¨ Table Editor ä¸­ï¼Œç‚¹å‡» "Insert row"
2. æ‰‹åŠ¨æ·»åŠ ä¸€è¡Œæ•°æ®
3. æ£€æŸ¥æ˜¯å¦èƒ½ä¿å­˜

**æ­¥éª¤ 5ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°**

1. æ‰“å¼€ä½ çš„ç½‘ç«™
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. ç‚¹å‡» "Console" æ ‡ç­¾
4. å°è¯•æ·»åŠ æ•°æ®
5. æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

---

## âŒ é—®é¢˜ 4ï¼šCORS é”™è¯¯

### ç—‡çŠ¶

```
Access to XMLHttpRequest at 'https://tianlai-backend.onrender.com/api/...' 
from origin 'https://tianlai-s-birthday-party.vercel.app' 
has been blocked by CORS policy
```

### åŸå› 

åç«¯ CORS é…ç½®ä¸åŒ…å«å‰ç«¯ URLã€‚

### è§£å†³æ–¹æ¡ˆ

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ CORS é…ç½®**

1. æ‰“å¼€ `backend/server.js`
2. æ‰¾åˆ° `corsOptions` éƒ¨åˆ†
3. æ£€æŸ¥æ˜¯å¦åŒ…å«ä½ çš„å‰ç«¯ URL

**æ­¥éª¤ 2ï¼šæ›´æ–° CORS é…ç½®**

å¦‚æœç¼ºå°‘å‰ç«¯ URLï¼Œæ·»åŠ å®ƒï¼š

```javascript
const corsOptions = {
    origin: [
        'http://localhost:5173',
        'http://localhost:3000',
        'https://tianlai-s-birthday-party.vercel.app',  // ä½ çš„å‰ç«¯ URL
        /\.vercel\.app$/  // å…è®¸æ‰€æœ‰ vercel.app å­åŸŸå
    ],
    credentials: true,
    optionsSuccessStatus: 200
};
```

**æ­¥éª¤ 3ï¼šæ¨é€ä»£ç **

```bash
git add .
git commit -m "ä¿®å¤ CORS é…ç½®"
git push
```

**æ­¥éª¤ 4ï¼šç­‰å¾…é‡æ–°éƒ¨ç½²**

Render ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²ã€‚ç­‰å¾… 2-3 åˆ†é’Ÿã€‚

---

## âŒ é—®é¢˜ 5ï¼šnpm install å¤±è´¥

### ç—‡çŠ¶

```
npm ERR! code ERESOLVE
npm ERR! ERESOLVE unable to resolve dependency tree
```

### åŸå› 

ä¾èµ–åŒ…ç‰ˆæœ¬å†²çªã€‚

### è§£å†³æ–¹æ¡ˆ

**æ­¥éª¤ 1ï¼šæœ¬åœ°æ¸…ç†**

```bash
cd backend
rm -rf node_modules
rm package-lock.json
npm install
```

**æ­¥éª¤ 2ï¼šæ¨é€ä»£ç **

```bash
cd ..
git add .
git commit -m "æ¸…ç†ä¾èµ–"
git push
```

**æ­¥éª¤ 3ï¼šåœ¨ Render ä¸­é‡æ–°éƒ¨ç½²**

1. ç™»å½• Render Dashboard
2. ç‚¹å‡»ä½ çš„åç«¯æœåŠ¡
3. ç‚¹å‡» "Manual Deploy"
4. ç­‰å¾…éƒ¨ç½²å®Œæˆ

---

## âŒ é—®é¢˜ 6ï¼šAPI Key æ³„éœ²

### ç—‡çŠ¶

ä½ ä¸å°å¿ƒæŠŠ API Key æäº¤åˆ°äº† GitHubã€‚

### åŸå› 

API Key è¢«æš´éœ²åœ¨å…¬å¼€çš„ä»£ç åº“ä¸­ã€‚

### è§£å†³æ–¹æ¡ˆ

**æ­¥éª¤ 1ï¼šç«‹å³é‡æ–°ç”Ÿæˆ Key**

1. ç™»å½• Supabase Dashboard
2. ç‚¹å‡» Settings â†’ API
3. æ‰¾åˆ°ä½ çš„ API Key
4. ç‚¹å‡»å³è¾¹çš„ä¸‰ä¸ªç‚¹ "..."
5. é€‰æ‹© "Regenerate"
6. ç¡®è®¤é‡æ–°ç”Ÿæˆ

**æ­¥éª¤ 2ï¼šæ›´æ–° Render ç¯å¢ƒå˜é‡**

1. ç™»å½• Render Dashboard
2. ç‚¹å‡»ä½ çš„åç«¯æœåŠ¡
3. ç‚¹å‡» "Environment"
4. æ›´æ–° `SUPABASE_KEY` ä¸ºæ–°çš„ Key
5. ç­‰å¾…é‡æ–°éƒ¨ç½²

**æ­¥éª¤ 3ï¼šä» Git å†å²ä¸­åˆ é™¤**

```bash
# æŸ¥çœ‹æäº¤å†å²
git log --oneline

# åˆ é™¤åŒ…å« Key çš„æäº¤ï¼ˆéœ€è¦è°¨æ…æ“ä½œï¼‰
# å»ºè®®è”ç³» GitHub æ”¯æŒ
```

---

## âŒ é—®é¢˜ 7ï¼šRender éƒ¨ç½²è¶…æ—¶

### ç—‡çŠ¶

```
Deployment failed: Build timed out after 30 minutes
```

### åŸå› 

éƒ¨ç½²è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼Œå¯¼è‡´è¶…æ—¶ã€‚

### è§£å†³æ–¹æ¡ˆ

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ Build Command**

1. ç™»å½• Render Dashboard
2. ç‚¹å‡»ä½ çš„åç«¯æœåŠ¡
3. ç‚¹å‡» "Settings"
4. æ£€æŸ¥ "Build Command" æ˜¯å¦ä¸º `npm install`

**æ­¥éª¤ 2ï¼šæ£€æŸ¥ Start Command**

1. åœ¨ Settings ä¸­ï¼Œæ£€æŸ¥ "Start Command" æ˜¯å¦ä¸º `node server.js`

**æ­¥éª¤ 3ï¼šæ‰‹åŠ¨é‡æ–°éƒ¨ç½²**

1. ç‚¹å‡» "Manual Deploy"
2. ç­‰å¾…éƒ¨ç½²å®Œæˆ

**æ­¥éª¤ 4ï¼šæ£€æŸ¥æ—¥å¿—**

1. ç‚¹å‡» "Logs"
2. æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

---

## âŒ é—®é¢˜ 8ï¼šæ•°æ®åº“è¿æ¥è¶…æ—¶

### ç—‡çŠ¶

```
Error: connect ETIMEDOUT
```

### åŸå› 

Supabase æœåŠ¡å™¨å“åº”ç¼“æ…¢æˆ–ç½‘ç»œé—®é¢˜ã€‚

### è§£å†³æ–¹æ¡ˆ

**æ­¥éª¤ 1ï¼šæ£€æŸ¥ Supabase çŠ¶æ€**

1. è®¿é—® https://status.supabase.com
2. æŸ¥çœ‹æ˜¯å¦æœ‰æœåŠ¡ä¸­æ–­

**æ­¥éª¤ 2ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥**

1. ç¡®ä¿ä½ çš„ç½‘ç»œè¿æ¥æ­£å¸¸
2. å°è¯•åœ¨å…¶ä»–ç½‘ç»œä¸Šæµ‹è¯•

**æ­¥éª¤ 3ï¼šç­‰å¾…å¹¶é‡è¯•**

1. ç­‰å¾…å‡ åˆ†é’Ÿ
2. æ‰‹åŠ¨é‡æ–°éƒ¨ç½²
3. é‡æ–°æµ‹è¯•

---

## âœ… é—®é¢˜ 9ï¼šä¸€åˆ‡æ­£å¸¸ï¼Œä½†æƒ³éªŒè¯

### éªŒè¯æ¸…å•

- [ ] Render æ—¥å¿—æ˜¾ç¤º "âœ… Supabase è¿æ¥æˆåŠŸ"
- [ ] Render æ—¥å¿—æ˜¾ç¤º "âœ… ä» Supabase åŠ è½½æ•°æ®æˆåŠŸ"
- [ ] ç½‘ç«™èƒ½è®¿é—®
- [ ] èƒ½æ·»åŠ æ•°æ®
- [ ] æ•°æ®åœ¨ Supabase è¡¨ä¸­å¯è§
- [ ] åˆ·æ–°é¡µé¢åæ•°æ®ä»ç„¶å­˜åœ¨
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ²¡æœ‰é”™è¯¯

å¦‚æœä»¥ä¸Šéƒ½æ»¡è¶³ï¼Œè¯´æ˜é…ç½®æˆåŠŸï¼

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹ Render æ—¥å¿—

```bash
# åœ¨ Render Dashboard ä¸­
1. ç‚¹å‡»ä½ çš„æœåŠ¡
2. ç‚¹å‡» "Logs"
3. æŸ¥çœ‹æœ€æ–°çš„æ—¥å¿—
```

### 2. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°

```bash
# åœ¨ä½ çš„ç½‘ç«™ä¸Š
1. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
2. ç‚¹å‡» "Console" æ ‡ç­¾
3. å°è¯•æ“ä½œ
4. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
```

### 3. æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

```bash
# åœ¨ä½ çš„ç½‘ç«™ä¸Š
1. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
2. ç‚¹å‡» "Network" æ ‡ç­¾
3. å°è¯•æ“ä½œ
4. æŸ¥çœ‹ API è¯·æ±‚å’Œå“åº”
```

### 4. æµ‹è¯• API è¿æ¥

```bash
# åœ¨ç»ˆç«¯ä¸­æµ‹è¯•
curl https://tianlai-backend.onrender.com/api/data

# åº”è¯¥è¿”å› JSON æ•°æ®
```

---

## ğŸ“ éœ€è¦æ›´å¤šå¸®åŠ©ï¼Ÿ

### æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£

- `SUPABASE_DETAILED_GUIDE.md` - å®Œæ•´çš„é…ç½®æ•™ç¨‹
- `SUPABASE_VISUAL_GUIDE.md` - å¯è§†åŒ–æ­¥éª¤æŒ‡å—
- `SUPABASE_CHECKLIST.md` - é…ç½®æ£€æŸ¥æ¸…å•

### å®˜æ–¹èµ„æº

- [Supabase æ–‡æ¡£](https://supabase.com/docs)
- [Render æ–‡æ¡£](https://render.com/docs)
- [Express.js æ–‡æ¡£](https://expressjs.com/)

### å¸¸è§å‘½ä»¤

```bash
# æŸ¥çœ‹ git çŠ¶æ€
git status

# æŸ¥çœ‹æœ€è¿‘çš„æäº¤
git log --oneline -5

# é‡æ–°å®‰è£…ä¾èµ–
cd backend && npm install && cd ..

# æœ¬åœ°æµ‹è¯•
cd backend && npm start
```

---

## ğŸ’¡ é¢„é˜²æªæ–½

1. **å®šæœŸå¤‡ä»½æ•°æ®**
   - åœ¨ Supabase ä¸­å¯¼å‡ºæ•°æ®
   - ä¿å­˜åˆ°æœ¬åœ°

2. **ç›‘æ§æ—¥å¿—**
   - å®šæœŸæ£€æŸ¥ Render æ—¥å¿—
   - åŠæ—¶å‘ç°é—®é¢˜

3. **æµ‹è¯•åŠŸèƒ½**
   - æ¯æ¬¡éƒ¨ç½²åéƒ½æµ‹è¯•ä¸€é
   - ç¡®ä¿ä¸€åˆ‡æ­£å¸¸

4. **ä¿æŠ¤å‡­è¯**
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  API Key
   - ä½¿ç”¨ç¯å¢ƒå˜é‡

---

**ç¥ä½ è°ƒè¯•é¡ºåˆ©ï¼ğŸš€**

